(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5577,5289],{65289:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return f},useAuth:function(){return v}});var n=t(59499),a=t(50029),o=t(64687),u=t.n(o),s=t(92401),i=t(11163),c=t(87553),l=t(5802);function d(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function h(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?d(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var p=(0,s.createContext)(void 0),f=function(e){var r,t,n,o,d,f,v=e.children,b=(0,c.createClient)(),g=(0,s.useState)(null),m=g[0],w=g[1],x=(0,s.useState)(null),O=x[0],C=x[1],k=(0,s.useState)(null),y=k[0],A=k[1],S=(0,s.useState)(!0),j=S[0],I=S[1];(0,i.useRouter)(),(0,s.useEffect)(function(){I(!0),b.auth.getSession().then(function(e){var r,t,n=e.data.session;w(n);var a=null!==(r=null==n?void 0:n.user)&&void 0!==r?r:null;C(a),A((null==a||null===(t=a.user_metadata)||void 0===t?void 0:t.role)||null),I(!1)}).catch(function(e){console.error("Error getting initial session:",e),I(!1)});var e=b.auth.onAuthStateChange(function(e,r){console.log("[AuthContext] Auth state changed. Event: ".concat(e),{hasSession:!!r}),w(r);var t,n,a=null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null;C(a),A((null==a||null===(n=a.user_metadata)||void 0===n?void 0:n.role)||null),I(!1)}).data.subscription;return function(){e.unsubscribe()}},[]);var R={session:m,user:O,loading:j,userRole:y,signIn:(r=(0,a.Z)(u().mark(function e(r,t){var n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.auth.signInWithPassword({email:r,password:t});case 3:return n=e.sent,e.abrupt("return",{data:n.data,error:n.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t){return r.apply(this,arguments)}),signInWithGoogle:(t=(0,a.Z)(u().mark(function e(){var r;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});case 3:return r=e.sent,e.abrupt("return",{data:r.data,error:r.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return t.apply(this,arguments)}),signUp:(n=(0,a.Z)(u().mark(function e(r,t,n){var a;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Registrierung gestartet mit:",{email:r,userData:n}),e.next=4,b.auth.signUp({email:r,password:t,options:{data:h(h({},n),{},{role:(null==n?void 0:n.role)||"CUSTOMER"}),emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});case 4:return(a=e.sent).error?console.error("Supabase Registrierungsfehler:",a.error):console.log("Registrierung erfolgreich:",a.data),e.abrupt("return",{data:a.data,error:a.error});case 9:return e.prev=9,e.t0=e.catch(0),console.error("Unerwarteter Fehler bei der Registrierung:",e.t0),e.abrupt("return",{data:null,error:h({message:"Verbindungsfehler zum Authentifizierungsserver. Bitte versuchen Sie es sp\xe4ter erneut."},e.t0)});case 13:case"end":return e.stop()}},e,null,[[0,9]])})),function(e,r,t){return n.apply(this,arguments)}),signOut:(o=(0,a.Z)(u().mark(function e(){var r;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.auth.signOut();case 3:return r=e.sent.error,e.abrupt("return",{error:r});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{error:e.t0});case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return o.apply(this,arguments)}),resetPassword:(d=(0,a.Z)(u().mark(function e(r){var t;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.auth.resetPasswordForEmail(r,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 3:return t=e.sent,e.abrupt("return",{data:t.data,error:t.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return d.apply(this,arguments)}),handleAuthCallback:(f=(0,a.Z)(u().mark(function e(r){var t,n,a,o,s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.auth.exchangeCodeForSession(r);case 3:if(a=(n=e.sent).data,!(o=n.error)){e.next=8;break}return e.abrupt("return",{error:o,userRole:void 0});case 8:return s=(null==a||null===(t=a.session)||void 0===t||null===(t=t.user)||void 0===t||null===(t=t.user_metadata)||void 0===t?void 0:t.role)||"CUSTOMER",e.abrupt("return",{error:null,userRole:s});case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{error:e.t0,userRole:void 0});case 15:case"end":return e.stop()}},e,null,[[0,12]])})),function(e){return f.apply(this,arguments)})};return(0,l.jsx)(p.Provider,{value:R,children:v})},v=function(){var e=(0,s.useContext)(p);if(void 0===e)throw Error("useAuth muss innerhalb eines AuthProviders verwendet werden");return e}},16250:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return s}});var n=t(92401),a=t(11163),o=t(65289),u=t(5802);function s(){var e=(0,a.useRouter)(),r=(0,o.useAuth)().handleAuthCallback;return(0,n.useEffect)(function(){var t=e.query.code;t&&r(t).then(function(r){var t=r.error,n=r.userRole;if(t)console.error("Fehler beim Austausch des Auth-Codes:",t),e.push("/auth/login?error=auth_callback_error");else{var a=(null==n?void 0:n.toUpperCase())||"CUSTOMER";switch(console.log("OAuth Callback - Benutzerrolle erkannt:",a),sessionStorage.removeItem("redirectAttempt"),a){case"ADMIN":console.log("Admin-Benutzer erkannt, Weiterleitung zum Admin-Dashboard..."),e.push("/dashboard/admin");break;case"RESTAURANT":console.log("Restaurant-Benutzer erkannt, Weiterleitung zum Restaurant-Dashboard..."),e.push("/restaurant/dashboard");break;default:console.log("Kunden-Benutzer erkannt, Weiterleitung zum Kunden-Dashboard..."),e.push("/customer/dashboard")}}})},[e.query,e,r]),(0,u.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,u.jsxs)("div",{className:"text-center",children:[(0,u.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Authentifizierung l\xe4uft..."}),(0,u.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500 mx-auto"})]})})}},87553:function(e,r,t){"use strict";t.r(r),t.d(r,{createClient:function(){return a}});var n=t(86405);function a(){console.log("Client createClient: Erstelle Browser-Client"),window.location.protocol;var e=window.location.hostname,r=e.includes("contact-tables.org");e.includes("netlify.app");var t={name:"contact-tables-auth",maxAge:604800,sameSite:"lax",path:"/",secure:!0};r&&(console.log("Client: Cookie Domain f\xfcr .contact-tables.org gesetzt"),Object.assign(t,{domain:".contact-tables.org"}));var a=(0,n.createBrowserClient)("https://efmbzrmroyetcqxcwxka.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4",{cookieOptions:t});return a.auth.getSession().then(function(e){console.log("Client createClient: Session vorhanden?",!!e.data.session)}).catch(function(e){console.error("Client createClient: Fehler beim Abrufen der Session:",e)}),a}},88575:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/callback",function(){return t(16250)}])},11163:function(e,r,t){e.exports=t(11171)},50029:function(e,r,t){"use strict";function n(e,r,t,n,a,o,u){try{var s=e[o](u),i=s.value}catch(e){t(e);return}s.done?r(i):Promise.resolve(i).then(n,a)}function a(e){return function(){var r=this,t=arguments;return new Promise(function(a,o){var u=e.apply(r,t);function s(e){n(u,a,o,s,i,"next",e)}function i(e){n(u,a,o,s,i,"throw",e)}s(void 0)})}}t.d(r,{Z:function(){return a}})}},function(e){e.O(0,[6405,2888,9774,179],function(){return e(e.s=88575)}),_N_E=e.O()}]);