(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4135],{72103:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return h}});var n=r(50029),s=r(64687),a=r.n(s),i=r(92401),l=r(11163),c=r(63708),u=r(17662),o=r(95443),d=r(88314),x=r(5802),h=!0;t.default=function(){var e,t,r,s=(0,l.useRouter)(),h=s.query.id,m=(0,i.useState)(!0),p=m[0],f=m[1],b=(0,i.useState)(!1),g=b[0],v=b[1],j=(0,i.useState)(!1),k=j[0],N=j[1],y=(0,i.useState)(""),w=y[0],S=y[1],_=(0,i.useState)(""),E=_[0],C=_[1],Z=(0,i.useState)(""),T=Z[0],F=Z[1],L=(0,i.useState)(""),B=L[0],P=L[1],O=(0,i.useState)(null),D=O[0],I=O[1],R=(0,i.useState)(!1),V=R[0],X=R[1],q=(0,i.useState)(!1),z=q[0],A=q[1],H=(0,i.useRef)(null);(0,i.useEffect)(function(){if(h){var e;(e=(0,n.Z)(a().mark(function e(){var t,r,n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f(!0),e.next=4,fetch("/api/admin/blogs/".concat(h));case 4:return t=e.sent,e.next=7,t.json();case 7:if(r=e.sent,t.ok){e.next=10;break}throw Error((null==r?void 0:r.message)||"Laden fehlgeschlagen");case 10:S((n=r.post).title||""),C(n.slug||""),F(n.excerpt||""),P(n.content||""),I(n.featured_image||null),X(!!n.published),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(0),console.error(e.t0),alert((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"Fehler beim Laden"),s.push("/admin/blogs");case 24:return e.prev=24,f(!1),e.finish(24);case 27:case"end":return e.stop()}},e,null,[[0,19,24,27]])})),function(){return e.apply(this,arguments)})()}},[h,s]);var J=(e=(0,n.Z)(a().mark(function e(t){var r,n,s,i;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===(r=t.target.files)||void 0===r?void 0:r[0]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,A(!0),(s=new FormData).append("file",n),e.next=9,fetch("/api/upload/image",{method:"POST",body:s});case 9:if((i=e.sent).ok){e.next=16;break}return e.t0=Error,e.next=14,i.text();case 14:throw e.t1=e.sent,new e.t0(e.t1);case 16:return e.next=18,i.json();case 18:I(e.sent.url),e.next=26;break;case 22:e.prev=22,e.t2=e.catch(3),console.error("Featured upload failed",e.t2),alert("Fehler beim Hochladen des Titelbildes");case 26:return e.prev=26,A(!1),H.current&&(H.current.value=""),e.finish(26);case 30:case"end":return e.stop()}},e,null,[[3,22,26,30]])})),function(t){return e.apply(this,arguments)}),M=(t=(0,n.Z)(a().mark(function e(t){var r,n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),h){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,v(!0),e.next=7,fetch("/api/admin/blogs/".concat(h),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:w.trim(),slug:E.trim()||void 0,excerpt:T.trim(),content:B,featured_image:D,published:V})});case 7:return r=e.sent,e.next=10,r.json();case 10:if(n=e.sent,r.ok){e.next=13;break}throw Error((null==n?void 0:n.message)||"Fehler");case 13:alert("Beitrag gespeichert"),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),console.error(e.t0),alert((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"Fehler beim Speichern");case 20:return e.prev=20,v(!1),e.finish(20);case 23:case"end":return e.stop()}},e,null,[[3,16,20,23]])})),function(e){return t.apply(this,arguments)}),U=(r=(0,n.Z)(a().mark(function e(){var t,r;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h){e.next=2;break}return e.abrupt("return");case 2:if(confirm("M\xf6chten Sie diesen Beitrag wirklich l\xf6schen?")){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,N(!0),e.next=8,fetch("/api/admin/blogs/".concat(h),{method:"DELETE"});case 8:return t=e.sent,e.next=11,t.json();case 11:if(r=e.sent,t.ok){e.next=14;break}throw Error((null==r?void 0:r.message)||"Fehler");case 14:s.push("/admin/blogs"),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),console.error(e.t0),alert((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"Fehler beim L\xf6schen");case 21:return e.prev=21,N(!1),e.finish(21);case 24:case"end":return e.stop()}},e,null,[[4,17,21,24]])})),function(){return r.apply(this,arguments)});return p?(0,x.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,x.jsx)(c.Z,{}),(0,x.jsx)("main",{className:"flex-1 p-6 bg-gray-50 flex items-center justify-center",children:(0,x.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}),(0,x.jsx)(u.Z,{})]}):(0,x.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,x.jsx)(c.Z,{}),(0,x.jsxs)("div",{className:"flex flex-1",children:[(0,x.jsx)(o.Z,{activeItem:"blogs"}),(0,x.jsx)("main",{className:"flex-1 p-6 bg-gray-50",children:(0,x.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,x.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Blog-Beitrag bearbeiten"}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsx)("button",{className:"px-3 py-2 border rounded",onClick:function(){return s.push("/admin/blogs")},children:"Zur\xfcck"}),(0,x.jsx)("button",{className:"px-3 py-2 border rounded text-red-600",onClick:U,disabled:k,children:k?"L\xf6schen...":"L\xf6schen"})]})]}),(0,x.jsxs)("form",{onSubmit:M,className:"bg-white shadow-sm rounded-lg border border-gray-200 p-6 space-y-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titel"}),(0,x.jsx)("input",{type:"text",value:w,onChange:function(e){return S(e.target.value)},className:"w-full border rounded px-3 py-2"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Slug"}),(0,x.jsx)("input",{type:"text",value:E,onChange:function(e){return C(e.target.value)},className:"w-full border rounded px-3 py-2"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Auszug"}),(0,x.jsx)("textarea",{value:T,onChange:function(e){return F(e.target.value)},className:"w-full border rounded px-3 py-2 min-h-[80px]"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Inhalt"}),(0,x.jsx)(d.Z,{value:B,onChange:P})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titelbild"}),(0,x.jsxs)("div",{className:"flex items-center gap-3",children:[(0,x.jsx)("button",{type:"button",className:"px-3 py-2 border rounded",onClick:function(){var e;return null===(e=H.current)||void 0===e?void 0:e.click()},disabled:z,children:z?"Wird hochgeladen...":"Bild hochladen"}),D&&(0,x.jsx)("a",{href:D,target:"_blank",rel:"noreferrer",className:"text-indigo-600 underline text-sm",children:"Vorschau"}),(0,x.jsx)("input",{hidden:!0,ref:H,type:"file",accept:"image/*",onChange:J})]})]}),(0,x.jsx)("div",{className:"flex items-end",children:(0,x.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,x.jsx)("input",{type:"checkbox",checked:V,onChange:function(e){return X(e.target.checked)}}),(0,x.jsx)("span",{className:"text-sm text-gray-700",children:"Ver\xf6ffentlicht"})]})})]}),(0,x.jsx)("div",{className:"flex justify-end gap-3",children:(0,x.jsx)("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded",disabled:g,children:g?"Speichern...":"Speichern"})})]})]})})]}),(0,x.jsx)(u.Z,{})]})}},14314:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/blogs/edit/[id]",function(){return r(72103)}])}},function(e){e.O(0,[6130,3365,6911,1509,6058,6405,8428,300,1012,3708,2567,2888,9774,179],function(){return e(e.s=14314)}),_N_E=e.O()}]);