(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7232],{16299:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return b}});var n=t(59499),s=t(50029),a=t(64687),i=t.n(a),o=t(11163),c=t(92401),u=t(63708),l=t(17662),d=t(26073),m=t(89681),p=t(65289),f=t(83596),h=t(5802);function x(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function g(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?x(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function b(){var e,r,t=(0,p.useAuth)(),a=t.session,x=t.user,b=t.loading,v=(0,o.useRouter)(),w=(0,c.useState)(!0),y=w[0],j=w[1],N=(0,c.useState)(!1),k=N[0],O=N[1],C=(0,c.useState)(!1),S=C[0],P=C[1],_=(0,c.useState)(null),Z=_[0],I=_[1],z=(0,c.useState)({name:"",email:"",phone:"",address:"",city:"",zipCode:""}),E=z[0],U=z[1],F=(e=(0,s.Z)(i().mark(function e(){var r,t,n,s,a,o,c,u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!x||!x.id)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,f.supabase.from("profiles").select("*").eq("id",x.id).single();case 5:if(c=(o=e.sent).data,!((u=o.error)&&"PGRST116"!==u.code)){e.next=10;break}throw u;case 10:U({name:null!=c&&c.first_name&&null!=c&&c.last_name?"".concat(c.first_name," ").concat(c.last_name):(null===(r=x.user_metadata)||void 0===r?void 0:r.name)||"",email:x.email||"",phone:(null==c?void 0:c.phone)||(null===(t=x.user_metadata)||void 0===t?void 0:t.phone)||"",address:(null===(n=x.user_metadata)||void 0===n?void 0:n.address)||"",city:(null===(s=x.user_metadata)||void 0===s?void 0:s.city)||"",zipCode:(null===(a=x.user_metadata)||void 0===a?void 0:a.zipCode)||""}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Fehler beim Laden des Profils:",e.t0),I("Profildaten konnten nicht geladen werden.");case 17:return e.prev=17,j(!1),e.finish(17);case 20:case"end":return e.stop()}},e,null,[[2,13,17,20]])})),function(){return e.apply(this,arguments)});(0,c.useEffect)(function(){if(!b){if(!a){v.push("/auth/login");return}if(x)try{var e,r=(((null===(e=x.user_metadata)||void 0===e?void 0:e.role)||"")+"").toUpperCase();if("CUSTOMER"!==r&&"USER"!==r){v.push("/");return}F()}catch(e){console.error("Fehler bei der Rollenpr\xfcfung:",e),j(!1)}else j(!1)}},[a,x,b,v]),(0,c.useEffect)(function(){x&&x.email&&x.email!==E.email&&U(function(e){return g(g({},e),{},{email:x.email})})},[null==x?void 0:x.email]);var D=function(e){var r=e.target,t=r.name,s=r.value;U(function(e){return g(g({},e),{},(0,n.Z)({},t,s))})},T=(r=(0,s.Z)(i().mark(function e(r){var t,n,s,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),O(!0),I(null),P(!1),console.log("[handleSubmit] Current session from useAuth:",JSON.stringify(a,null,2)),console.log("[handleSubmit] Current user from useAuth:",JSON.stringify(x,null,2)),!(!a||!x||!x.id)){e.next=10;break}return I("Benutzersitzung nicht gefunden oder ung\xfcltig. Bitte melden Sie sich erneut an."),O(!1),e.abrupt("return");case 10:return e.prev=10,e.next=13,f.supabase.from("profiles").upsert({id:x.id,first_name:E.name.split(" ")[0]||"",last_name:E.name.split(" ").slice(1).join(" ")||"",updated_at:new Date().toISOString()});case 13:if(!(t=e.sent.error)){e.next=17;break}throw t;case 17:if(!(E.email&&E.email!==x.email)){e.next=24;break}return e.next=20,f.supabase.auth.updateUser({email:E.email});case 20:if(!(n=e.sent.error)){e.next=24;break}throw n;case 24:return e.next=26,f.supabase.auth.updateUser({data:{name:E.name,email:E.email,phone:E.phone,address:E.address,city:E.city,zipCode:E.zipCode}});case 26:if(!(s=e.sent.error)){e.next=30;break}throw s;case 30:P(!0),setTimeout(function(){return P(!1)},3e3),e.next=41;break;case 34:e.prev=34,e.t0=e.catch(10),console.error("Detaillierter Fehler beim Speichern des Profils:",e.t0),o="Das Profil konnte nicht gespeichert werden. Bitte versuchen Sie es sp\xe4ter erneut.",e.t0&&e.t0.message&&(o+=" Fehlerdetails: ".concat(e.t0.message)),I(o),e.t0&&(e.t0.code||e.t0.details||e.t0.hint)&&console.error("Supabase error object:",JSON.stringify(e.t0,null,2));case 41:return e.prev=41,O(!1),e.finish(41);case 44:case"end":return e.stop()}},e,null,[[10,34,41,44]])})),function(e){return r.apply(this,arguments)});return y?(0,h.jsxs)("div",{className:"min-h-screen flex flex-col",children:[" ",(0,h.jsx)(u.Z,{}),(0,h.jsx)("main",{className:"flex-grow flex items-center justify-center",children:(0,h.jsxs)("div",{className:"text-center",children:[(0,h.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),(0,h.jsx)("p",{className:"mt-4 text-lg",children:"Laden..."})]})}),(0,h.jsx)(l.Z,{})]}):(0,h.jsxs)("div",{className:"min-h-screen flex flex-col",children:[" ",(0,h.jsx)(u.Z,{}),(0,h.jsxs)("div",{className:"flex-grow flex",children:[(0,h.jsx)(d.Z,{activePage:"profile"}),(0,h.jsx)("main",{className:"flex-grow bg-gray-50 p-6",children:(0,h.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,h.jsx)("div",{className:"bg-white shadow-lg rounded-lg p-6 md:p-8",children:(0,h.jsx)(m.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,h.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,h.jsxs)("div",{className:"px-4 py-5 sm:px-6 border-b border-gray-200",children:[(0,h.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Mein Profil"}),(0,h.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Bearbeiten Sie Ihre pers\xf6nlichen Informationen"})]}),(0,h.jsxs)("form",{onSubmit:T,className:"px-4 py-5 sm:p-6",children:[S&&(0,h.jsx)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md",children:(0,h.jsx)("p",{className:"text-green-700",children:"Profil erfolgreich aktualisiert!"})}),Z&&(0,h.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,h.jsx)("p",{className:"text-red-700",children:Z})}),(0,h.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Vollst\xe4ndiger Name"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("input",{type:"text",name:"name",id:"name",autoComplete:"name",value:E.name,onChange:D,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"E-Mail-Adresse"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("input",{type:"email",name:"email",id:"email",autoComplete:"email",value:E.email,onChange:D,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Telefonnummer"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("input",{type:"tel",name:"phone",id:"phone",autoComplete:"tel",value:E.phone,onChange:D,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),(0,h.jsxs)("div",{className:"sm:col-span-2",children:[(0,h.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700",children:"Adresse"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("input",{type:"text",name:"address",id:"address",autoComplete:"street-address",value:E.address,onChange:D,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:"Stadt"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("input",{type:"text",name:"city",id:"city",autoComplete:"address-level2",value:E.city,onChange:D,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"zipCode",className:"block text-sm font-medium text-gray-700",children:"Postleitzahl"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("input",{type:"text",name:"zipCode",id:"zipCode",autoComplete:"postal-code",value:E.zipCode,onChange:D,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"})})]})]}),(0,h.jsx)("div",{className:"mt-8 pt-5 border-t border-gray-200",children:(0,h.jsx)("div",{className:"flex justify-end",children:(0,h.jsx)("button",{type:"submit",disabled:k,className:"ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:k?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,h.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,h.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Speichern..."]}):"\xc4nderungen speichern"})})})]})]})})})})})]}),(0,h.jsx)(l.Z,{})]})}},83596:function(e,r,t){"use strict";t.r(r),t.d(r,{admin:function(){return P},auth:function(){return O},profiles:function(){return C},restaurants:function(){return S},supabase:function(){return k}});var n,s,a,i,o,c,u,l,d,m,p,f,h=t(59499),x=t(50029),g=t(64687),b=t.n(g),v=t(86405);function w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function y(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?w(Object(t),!0).forEach(function(r){(0,h.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var j="https://efmbzrmroyetcqxcwxka.supabase.co",N="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4";j&&N||console.error("Kritischer Fehler: Supabase URL oder Anon Key fehlen in der Client-Konfiguration.");var k=(0,v.createBrowserClient)(j,N,{auth:{storageKey:"contact-tables-auth",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),O={signUp:(n=(0,x.Z)(b().mark(function e(r,t){var n,s,a,i,o=arguments;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:{},e.next=3,k.auth.signUp({email:r,password:t,options:{data:y(y({},n),{},{role:n.role||"CUSTOMER"})}});case 3:return a=(s=e.sent).data,i=s.error,e.abrupt("return",{data:a,error:i});case 7:case"end":return e.stop()}},e)})),function(e,r){return n.apply(this,arguments)}),signIn:(s=(0,x.Z)(b().mark(function e(r,t){var n,s,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.signInWithPassword({email:r,password:t});case 2:return s=(n=e.sent).data,a=n.error,e.abrupt("return",{data:s,error:a});case 6:case"end":return e.stop()}},e)})),function(e,r){return s.apply(this,arguments)}),signInWithGoogle:(a=(0,x.Z)(b().mark(function e(r){var t,n,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.signInWithOAuth({provider:"google",options:{redirectTo:(null==r?void 0:r.redirectTo)||"".concat(window.location.origin,"/auth/callback")}});case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),signOut:(i=(0,x.Z)(b().mark(function e(){var r;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.signOut();case 2:return r=e.sent.error,e.abrupt("return",{error:r});case 5:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)}),getUser:(o=(0,x.Z)(b().mark(function e(){var r,t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.getUser();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)}),getSession:(c=(0,x.Z)(b().mark(function e(){var r,t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.getSession();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)}),resetPassword:(u=(0,x.Z)(b().mark(function e(r){var t,n,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.resetPasswordForEmail(r,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)}),updatePassword:(l=(0,x.Z)(b().mark(function e(r){var t,n,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.updateUser({password:r});case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})},C={getProfile:(d=(0,x.Z)(b().mark(function e(r){var t,n,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("profiles").select("*").eq("id",r).single();case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return d.apply(this,arguments)}),updateProfile:(m=(0,x.Z)(b().mark(function e(r,t){var n,s,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("profiles").update(t).eq("id",r);case 2:return s=(n=e.sent).data,a=n.error,e.abrupt("return",{data:s,error:a});case 6:case"end":return e.stop()}},e)})),function(e,r){return m.apply(this,arguments)})},S={getRestaurantProfile:(p=(0,x.Z)(b().mark(function e(r){var t,n,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("restaurants").select("*").eq("user_id",r).single();case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)})},P={getAllUsers:(f=(0,x.Z)(b().mark(function e(){var r,t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("profiles").select("*");case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return f.apply(this,arguments)})}},17040:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customer/profile",function(){return t(16299)}])}},function(e){e.O(0,[6130,3365,6058,6405,8428,300,3708,6328,2888,9774,179],function(){return e(e.s=17040)}),_N_E=e.O()}]);