(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2144],{78766:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return w}});var n=t(59499),a=t(50029),s=t(64687),i=t.n(s),c=t(11163),o=t(92401),u=t(63708),l=t(17662),d=t(26073),p=t(89681),f=t(65289),h=t(91472),x=t(83596),m=t(5802);function g(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function b(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?g(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function w(){var e,r,t,n,s=(0,f.useAuth)(),g=s.session,w=s.user,v=s.loading,y=(0,c.useRouter)(),j=(0,o.useState)(!0),k=j[0],N=j[1],O=(0,o.useState)([]),_=O[0],E=O[1],P=(0,o.useState)(null),S=P[0],I=P[1],Z=(e=(0,a.Z)(i().mark(function e(){var r,t,n,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!g||!w)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,N(!0),I(null),e.next=7,x.supabase.from("notifications").select("count()").limit(1);case 7:if(!(r=e.sent.error)){e.next=14;break}return console.warn("Benachrichtigungen-Tabelle m\xf6glicherweise nicht verf\xfcgbar:",r),E([]),N(!1),e.abrupt("return");case 14:return e.next=16,x.supabase.from("notifications").select("*").eq("user_id",w.id).order("created_at",{ascending:!1});case 16:if(n=(t=e.sent).data,!(a=t.error)){e.next=24;break}return console.error("Fehler beim Abrufen der Benachrichtigungen:",a),I("Die Benachrichtigungen konnten nicht geladen werden. Bitte versuche es sp\xe4ter erneut."),N(!1),e.abrupt("return");case 24:E(n||[]),N(!1),e.next=33;break;case 28:e.prev=28,e.t0=e.catch(2),console.error("Unerwarteter Fehler beim Laden der Benachrichtigungen:",e.t0),I("Die Benachrichtigungen konnten nicht geladen werden. Bitte versuche es sp\xe4ter erneut."),N(!1);case 33:case"end":return e.stop()}},e,null,[[2,28]])})),function(){return e.apply(this,arguments)}),D=(r=(0,a.Z)(i().mark(function e(r){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,x.supabase.from("notifications").update({is_read:!0}).eq("id",r).eq("user_id",w.id);case 5:if(!(t=e.sent.error)){e.next=9;break}throw t;case 9:E(_.map(function(e){return e.id===r?b(b({},e),{},{is_read:!0}):e})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Fehler beim Markieren als gelesen:",e.t0),I("Die Benachrichtigung konnte nicht als gelesen markiert werden. Bitte versuche es sp\xe4ter erneut.");case 16:case"end":return e.stop()}},e,null,[[2,12]])})),function(e){return r.apply(this,arguments)}),T=(t=(0,a.Z)(i().mark(function e(r){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,x.supabase.from("notifications").delete().eq("id",r).eq("user_id",w.id);case 5:if(!(t=e.sent.error)){e.next=9;break}throw t;case 9:E(_.filter(function(e){return e.id!==r})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Fehler beim L\xf6schen der Benachrichtigung:",e.t0),I("Die Benachrichtigung konnte nicht gel\xf6scht werden. Bitte versuche es sp\xe4ter erneut.");case 16:case"end":return e.stop()}},e,null,[[2,12]])})),function(e){return t.apply(this,arguments)}),B=(n=(0,a.Z)(i().mark(function e(){var r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!w||0===_.length)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,x.supabase.from("notifications").update({is_read:!0}).eq("user_id",w.id).eq("is_read",!1);case 5:if(!(r=e.sent.error)){e.next=9;break}throw r;case 9:E(_.map(function(e){return b(b({},e),{},{is_read:!0})})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("Fehler beim Markieren aller Benachrichtigungen als gelesen:",e.t0),I("Die Benachrichtigungen konnten nicht als gelesen markiert werden. Bitte versuche es sp\xe4ter erneut.");case 16:case"end":return e.stop()}},e,null,[[2,12]])})),function(){return n.apply(this,arguments)});(0,o.useEffect)(function(){if(!v){if(!g){y.push("/auth/login");return}if(w)try{var e,r=(((null===(e=w.user_metadata)||void 0===e?void 0:e.role)||"")+"").toUpperCase();if("CUSTOMER"!==r&&"USER"!==r){y.push("/");return}Z()}catch(e){console.error("Fehler bei der Rollenpr\xfcfung:",e),N(!1)}else N(!1)}},[g,w,v,y]);var U=function(e){switch(e){case"EVENT_INVITE":case"EVENT_UPDATE":case"EVENT_REMINDER":return(0,m.jsx)(h.vlc,{className:"h-6 w-6 text-indigo-500"});case"MESSAGE":return(0,m.jsx)(h.IC0,{className:"h-6 w-6 text-green-500"});case"SYSTEM":return(0,m.jsx)(h.nbt,{className:"h-6 w-6 text-gray-500"});default:return(0,m.jsx)(h.vWP,{className:"h-6 w-6 text-blue-500"})}},C=function(e){var r=new Date(e),t=Math.floor((new Date().getTime()-r.getTime())/864e5);return 0===t?"Heute, ".concat(r.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})):1===t?"Gestern, ".concat(r.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})):t<7?"Vor ".concat(t," Tagen"):r.toLocaleDateString("de-DE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})};return(0,m.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,m.jsx)(u.Z,{}),(0,m.jsxs)("div",{className:"flex-grow flex",children:[(0,m.jsx)(d.Z,{activePage:"notifications"}),(0,m.jsx)("main",{className:"flex-grow bg-gray-50 p-6",children:(0,m.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,m.jsx)("div",{className:"bg-white shadow-lg rounded-lg p-6 md:p-8",children:(0,m.jsxs)(p.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,m.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Benachrichtigungen"}),_.length>0&&(0,m.jsxs)("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:B,children:[(0,m.jsx)(h.UgA,{className:"mr-2"}),"Alle als gelesen markieren"]})]}),S&&(0,m.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,m.jsx)("p",{className:"text-red-700",children:S})}),k?(0,m.jsxs)("div",{className:"text-center py-10",children:[(0,m.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),(0,m.jsx)("p",{className:"mt-4 text-lg",children:"Laden..."})]}):0===_.length?(0,m.jsxs)("div",{className:"text-center py-10",children:[(0,m.jsx)(h.vWP,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,m.jsx)("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Keine Benachrichtigungen"}),(0,m.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Sie haben derzeit keine neuen Benachrichtigungen."})]}):(0,m.jsx)("div",{className:"space-y-4",children:_.map(function(e){return(0,m.jsx)("div",{className:"p-4 rounded-lg shadow-sm border ".concat(e.is_read?"bg-gray-50 border-gray-200":"bg-white border-blue-200"),children:(0,m.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,m.jsx)("div",{className:"flex-shrink-0",children:U(e.type)}),(0,m.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("p",{className:"text-sm font-medium ".concat(e.is_read?"text-gray-700":"text-gray-900"),children:e.title}),(0,m.jsx)("p",{className:"text-xs text-gray-500",children:e.created_at?C(e.created_at):""})]}),(0,m.jsx)("p",{className:"mt-1 text-sm ".concat(e.is_read?"text-gray-600":"text-gray-800"),children:e.content}),(0,m.jsxs)("div",{className:"mt-2 flex items-center space-x-3",children:[!e.is_read&&(0,m.jsx)("button",{onClick:function(){return D(e.id)},className:"text-xs font-medium text-indigo-600 hover:text-indigo-500",children:"Als gelesen markieren"}),(0,m.jsx)("button",{onClick:function(){return T(e.id)},className:"text-xs font-medium text-red-600 hover:text-red-500",children:"L\xf6schen"}),e.link&&(0,m.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-xs font-medium text-blue-600 hover:text-blue-500",children:"Details anzeigen"})]})]})]})},e.id)})})]})})," "]})})]}),(0,m.jsx)(l.Z,{})]})}},83596:function(e,r,t){"use strict";t.r(r),t.d(r,{admin:function(){return P},auth:function(){return O},profiles:function(){return _},restaurants:function(){return E},supabase:function(){return N}});var n,a,s,i,c,o,u,l,d,p,f,h,x=t(59499),m=t(50029),g=t(64687),b=t.n(g),w=t(86405);function v(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function y(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?v(Object(t),!0).forEach(function(r){(0,x.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var j="https://efmbzrmroyetcqxcwxka.supabase.co",k="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4";j&&k||console.error("Kritischer Fehler: Supabase URL oder Anon Key fehlen in der Client-Konfiguration.");var N=(0,w.createBrowserClient)(j,k,{auth:{storageKey:"contact-tables-auth",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),O={signUp:(n=(0,m.Z)(b().mark(function e(r,t){var n,a,s,i,c=arguments;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},e.next=3,N.auth.signUp({email:r,password:t,options:{data:y(y({},n),{},{role:n.role||"CUSTOMER"})}});case 3:return s=(a=e.sent).data,i=a.error,e.abrupt("return",{data:s,error:i});case 7:case"end":return e.stop()}},e)})),function(e,r){return n.apply(this,arguments)}),signIn:(a=(0,m.Z)(b().mark(function e(r,t){var n,a,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.auth.signInWithPassword({email:r,password:t});case 2:return a=(n=e.sent).data,s=n.error,e.abrupt("return",{data:a,error:s});case 6:case"end":return e.stop()}},e)})),function(e,r){return a.apply(this,arguments)}),signInWithGoogle:(s=(0,m.Z)(b().mark(function e(r){var t,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.auth.signInWithOAuth({provider:"google",options:{redirectTo:(null==r?void 0:r.redirectTo)||"".concat(window.location.origin,"/auth/callback")}});case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)}),signOut:(i=(0,m.Z)(b().mark(function e(){var r;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.auth.signOut();case 2:return r=e.sent.error,e.abrupt("return",{error:r});case 5:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)}),getUser:(c=(0,m.Z)(b().mark(function e(){var r,t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.auth.getUser();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)}),getSession:(o=(0,m.Z)(b().mark(function e(){var r,t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.auth.getSession();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)}),resetPassword:(u=(0,m.Z)(b().mark(function e(r){var t,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.auth.resetPasswordForEmail(r,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)}),updatePassword:(l=(0,m.Z)(b().mark(function e(r){var t,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.auth.updateUser({password:r});case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})},_={getProfile:(d=(0,m.Z)(b().mark(function e(r){var t,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.from("profiles").select("*").eq("id",r).single();case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return d.apply(this,arguments)}),updateProfile:(p=(0,m.Z)(b().mark(function e(r,t){var n,a,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.from("profiles").update(t).eq("id",r);case 2:return a=(n=e.sent).data,s=n.error,e.abrupt("return",{data:a,error:s});case 6:case"end":return e.stop()}},e)})),function(e,r){return p.apply(this,arguments)})},E={getRestaurantProfile:(f=(0,m.Z)(b().mark(function e(r){var t,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.from("restaurants").select("*").eq("user_id",r).single();case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return f.apply(this,arguments)})},P={getAllUsers:(h=(0,m.Z)(b().mark(function e(){var r,t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.from("profiles").select("*");case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return h.apply(this,arguments)})}},12268:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customer/notifications",function(){return t(78766)}])}},function(e){e.O(0,[6130,3365,6058,6405,8428,300,3708,6328,2888,9774,179],function(){return e(e.s=12268)}),_N_E=e.O()}]);