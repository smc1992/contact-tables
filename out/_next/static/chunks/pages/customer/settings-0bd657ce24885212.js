(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286],{84747:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var s=t(50029),i=t(59499),r=t(64687),a=t.n(r),c=t(11163),l=t(92401),o=t(63708),d=t(17662),h=t(89681),u=t(65289),m=t(91472),g=t(26073),x=t(5802);function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,s)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(Object(t),!0).forEach(function(n){(0,i.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function b(){var e,n=(0,u.useAuth)(),t=n.user,r=n.signOut,f=n.session,b=n.loading,j=(0,c.useRouter)(),v=(0,l.useState)(!0),N=v[0],y=v[1],k=(0,l.useState)({notificationsEmail:!0,notificationsPush:!0,notificationsNewEvents:!0,notificationsUpdates:!0,notificationsMarketing:!1,language:"de",privacyProfile:"private",privacyContactInfo:"private",privacyParticipation:"private"}),w=k[0],E=k[1],S=(0,l.useState)(!1),P=S[0],O=S[1],C=(0,l.useState)(!1),z=C[0],D=C[1],_=(0,l.useState)(null),A=_[0],B=_[1],F=(0,l.useState)(!1),I=F[0],K=F[1],M=(0,l.useState)(null),U=M[0],T=M[1];(0,l.useEffect)(function(){var e;if(console.log("Settings - Auth-Status:",{authLoading:b,userIsActive:!!t,userEmail:null==t?void 0:t.email,userRole:null==t||null===(e=t.user_metadata)||void 0===e?void 0:e.role}),b){console.log("Auth l\xe4dt noch, warte...");return}if(!t&&!b){console.log("Keine Sitzung gefunden, Weiterleitung zur Login-Seite..."),j.push("/auth/login");return}if(t)try{var n,s=(((null===(n=t.user_metadata)||void 0===n?void 0:n.role)||"")+"").toUpperCase();if(console.log("Benutzerrolle erkannt:",s),"CUSTOMER"!==s&&"USER"!==s){console.log("Unzul\xe4ssige Rolle f\xfcr Kunden-Bereich:",s),j.push("/");return}console.log("G\xfcltige Kundenrolle erkannt, lade Einstellungen..."),setTimeout(function(){var e,n=(null===(e=t.user_metadata)||void 0===e?void 0:e.settings)||{};E(p(p({},w),n)),y(!1)},500)}catch(e){console.error("Fehler bei der Rollenpr\xfcfung:",e),y(!1)}else console.log("Benutzer nicht gefunden, aber Sitzung vorhanden."),y(!1)},[t,b,j]);var Z=function(e){var n=e.target,t=n.name,s=n.value,r=n.type;E(function(n){return p(p({},n),{},(0,i.Z)({},t,"checkbox"===r?e.target.checked:s))})},W=(e=(0,s.Z)(a().mark(function e(n){var s,i,r,c,l,o;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),O(!0),B(null),D(!1),e.prev=4,console.log("Speichere Einstellungen:",w),console.log("Aktualisiere Profil mit:",i={name:(null==t||null===(s=t.user_metadata)||void 0===s?void 0:s.name)||"Benutzer",languageCode:w.language||"DE"}),e.next=10,fetch("/api/users/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 10:if((r=e.sent).ok){e.next=17;break}return e.next=14,r.json();case 14:throw console.error("Fehler beim Aktualisieren des Profils:",c=e.sent),Error(c.message||"Das Profil konnte nicht gespeichert werden.");case 17:return e.next=19,r.json();case 19:return console.log("Profil erfolgreich aktualisiert:",e.sent),console.log("Aktualisiere Einstellungen mit:",w),e.next=24,fetch("/api/users/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});case 24:if((l=e.sent).ok){e.next=31;break}return e.next=28,l.json();case 28:throw console.error("Fehler beim Aktualisieren der Einstellungen:",o=e.sent),Error(o.message||"Die Einstellungen konnten nicht gespeichert werden.");case 31:return e.next=33,l.json();case 33:console.log("Einstellungen erfolgreich aktualisiert:",e.sent),D(!0),setTimeout(function(){return D(!1)},3e3),e.next=43;break;case 39:e.prev=39,e.t0=e.catch(4),console.error("Fehler beim Speichern:",e.t0),B(e.t0.message||"Die Daten konnten nicht gespeichert werden. Bitte versuchen Sie es sp\xe4ter erneut.");case 43:return e.prev=43,O(!1),e.finish(43);case 46:case"end":return e.stop()}},e,null,[[4,39,43,46]])})),function(n){return e.apply(this,arguments)});return N?(0,x.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,x.jsx)(o.Z,{}),(0,x.jsx)("main",{className:"flex-grow flex items-center justify-center",children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),(0,x.jsx)("p",{className:"mt-4 text-lg",children:"Laden..."})]})}),(0,x.jsx)(d.Z,{})]}):(0,x.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,x.jsx)(o.Z,{}),(0,x.jsxs)("div",{className:"flex-grow flex",children:[(0,x.jsx)(g.Z,{activePage:"settings"}),(0,x.jsx)("main",{className:"flex-grow bg-gray-50 p-6",children:(0,x.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,x.jsx)(h.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,x.jsxs)("div",{className:"px-4 py-5 sm:px-6 border-b border-gray-200",children:[(0,x.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Einstellungen"}),(0,x.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Passen Sie Ihre Benachrichtigungs- und Datenschutzeinstellungen an"})]}),(0,x.jsxs)("form",{onSubmit:W,className:"px-4 py-5 sm:p-6",children:[z&&(0,x.jsx)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md",children:(0,x.jsx)("p",{className:"text-green-700",children:"Einstellungen erfolgreich gespeichert!"})}),A&&(0,x.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,x.jsx)("p",{className:"text-red-700",children:A})}),(0,x.jsxs)("div",{className:"mb-8",children:[(0,x.jsxs)("h2",{className:"text-lg font-medium text-gray-900 flex items-center",children:[(0,x.jsx)(m.nbt,{className:"mr-2 h-5 w-5 text-indigo-500"}),"Allgemeine Einstellungen"]}),(0,x.jsxs)("div",{className:"mt-4",children:[(0,x.jsx)("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700",children:"Sprache"}),(0,x.jsxs)("select",{id:"language",name:"language",value:w.language,onChange:Z,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[(0,x.jsx)("option",{value:"de",children:"Deutsch"}),(0,x.jsx)("option",{value:"en",children:"English"}),(0,x.jsx)("option",{value:"fr",children:"Fran\xe7ais"})]}),(0,x.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"W\xe4hlen Sie Ihre bevorzugte Sprache f\xfcr die Benutzeroberfl\xe4che"})]})]}),(0,x.jsxs)("div",{className:"mb-8 pt-8 border-t border-gray-200",children:[(0,x.jsxs)("h2",{className:"text-lg font-medium text-gray-900 flex items-center",children:[(0,x.jsx)(m.vWP,{className:"mr-2 h-5 w-5 text-indigo-500"}),"Benachrichtigungen"]}),(0,x.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,x.jsxs)("div",{className:"flex items-start",children:[(0,x.jsx)("div",{className:"flex items-center h-5",children:(0,x.jsx)("input",{id:"notificationsEmail",name:"notificationsEmail",type:"checkbox",checked:w.notificationsEmail,onChange:Z,className:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"})}),(0,x.jsxs)("div",{className:"ml-3 text-sm",children:[(0,x.jsx)("label",{htmlFor:"notificationsEmail",className:"font-medium text-gray-700",children:"E-Mail-Benachrichtigungen"}),(0,x.jsx)("p",{className:"text-gray-500",children:"Erhalten Sie Benachrichtigungen per E-Mail"})]})]}),(0,x.jsxs)("div",{className:"flex items-start",children:[(0,x.jsx)("div",{className:"flex items-center h-5",children:(0,x.jsx)("input",{id:"notificationsPush",name:"notificationsPush",type:"checkbox",checked:w.notificationsPush,onChange:Z,className:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"})}),(0,x.jsxs)("div",{className:"ml-3 text-sm",children:[(0,x.jsx)("label",{htmlFor:"notificationsPush",className:"font-medium text-gray-700",children:"Push-Benachrichtigungen"}),(0,x.jsx)("p",{className:"text-gray-500",children:"Erhalten Sie Push-Benachrichtigungen in der App"})]})]}),(0,x.jsxs)("div",{className:"flex items-start",children:[(0,x.jsx)("div",{className:"flex items-center h-5",children:(0,x.jsx)("input",{id:"notificationsNewEvents",name:"notificationsNewEvents",type:"checkbox",checked:w.notificationsNewEvents,onChange:Z,className:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"})}),(0,x.jsxs)("div",{className:"ml-3 text-sm",children:[(0,x.jsx)("label",{htmlFor:"notificationsNewEvents",className:"font-medium text-gray-700",children:"Neue Events & Vorschl\xe4ge"}),(0,x.jsx)("p",{className:"text-gray-500",children:"Benachrichtigungen \xfcber neue Kontakttische, die Sie interessieren k\xf6nnten"})]})]}),(0,x.jsxs)("div",{className:"flex items-start",children:[(0,x.jsx)("div",{className:"flex items-center h-5",children:(0,x.jsx)("input",{id:"notificationsUpdates",name:"notificationsUpdates",type:"checkbox",checked:w.notificationsUpdates,onChange:Z,className:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"})}),(0,x.jsxs)("div",{className:"ml-3 text-sm",children:[(0,x.jsx)("label",{htmlFor:"notificationsUpdates",className:"font-medium text-gray-700",children:"Updates zu Ihren Events"}),(0,x.jsx)("p",{className:"text-gray-500",children:"Benachrichtigungen \xfcber \xc4nderungen oder Nachrichten zu Ihren gebuchten Kontakttischen"})]})]}),(0,x.jsxs)("div",{className:"flex items-start",children:[(0,x.jsx)("div",{className:"flex items-center h-5",children:(0,x.jsx)("input",{id:"notificationsMarketing",name:"notificationsMarketing",type:"checkbox",checked:w.notificationsMarketing,onChange:Z,className:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"})}),(0,x.jsxs)("div",{className:"ml-3 text-sm",children:[(0,x.jsx)("label",{htmlFor:"notificationsMarketing",className:"font-medium text-gray-700",children:"Angebote & Marketing"}),(0,x.jsx)("p",{className:"text-gray-500",children:"Erhalten Sie Informationen zu Sonderangeboten und Marketingaktionen"})]})]})]})]}),(0,x.jsxs)("div",{className:"mb-8 pt-8 border-t border-gray-200",children:[(0,x.jsxs)("h2",{className:"text-lg font-medium text-gray-900 flex items-center",children:[(0,x.jsx)(m.bfl,{className:"mr-2 h-5 w-5 text-red-500"}),"Kontosicherheit"]}),(0,x.jsxs)("div",{className:"mt-4",children:[(0,x.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Wenn Sie Ihr Konto l\xf6schen, werden alle Ihre personenbezogenen Daten dauerhaft entfernt. Diese Aktion kann nicht r\xfcckg\xe4ngig gemacht werden."}),(0,x.jsxs)("button",{type:"button",onClick:(0,s.Z)(a().mark(function e(){var n,t,s;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("M\xf6chten Sie Ihr Konto wirklich dauerhaft l\xf6schen? Alle Ihre Daten gehen dabei verloren. Diese Aktion kann nicht r\xfcckg\xe4ngig gemacht werden.")){e.next=28;break}return K(!0),T(null),e.prev=3,console.log("Client-side access token for delete request:",n=null==f?void 0:f.access_token),t={"Content-Type":"application/json"},n&&(t.Authorization="Bearer ".concat(n)),e.next=10,fetch("/api/user/delete",{method:"DELETE",headers:t,credentials:"include"});case 10:if((s=e.sent).ok){e.next=16;break}return e.next=14,s.json();case 14:throw Error(e.sent.message||"Fehler beim L\xf6schen des Kontos.");case 16:alert("Ihr Konto wurde erfolgreich gel\xf6scht."),r(),j.push("/"),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),console.error("Fehler beim L\xf6schen des Kontos:",e.t0),T(e.t0.message||"Ein unbekannter Fehler ist aufgetreten.");case 25:return e.prev=25,K(!1),e.finish(25);case 28:case"end":return e.stop()}},e,null,[[3,21,25,28]])})),className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",disabled:I,children:[(0,x.jsx)(m.Ybf,{className:"mr-2 h-5 w-5"}),I?"Wird gel\xf6scht...":"Konto dauerhaft l\xf6schen"]}),U&&(0,x.jsx)("p",{className:"mt-2 text-sm text-red-600",children:U})]})]}),(0,x.jsx)("div",{className:"pt-5 border-t border-gray-200",children:(0,x.jsx)("div",{className:"flex justify-end",children:(0,x.jsx)("button",{type:"submit",disabled:P,className:"ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:P?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,x.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,x.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Speichern..."]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(m.mW3,{className:"mr-2 h-5 w-5"}),"Einstellungen speichern"]})})})})]})]})})})})]}),(0,x.jsx)(d.Z,{})]})}},29324:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customer/settings",function(){return t(84747)}])}},function(e){e.O(0,[6130,3365,6058,6405,8428,300,3708,6328,2888,9774,179],function(){return e(e.s=29324)}),_N_E=e.O()}]);