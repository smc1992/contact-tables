(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4410],{20260:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return v}});var n=t(50029),s=t(64687),a=t.n(s),i=t(11163),c=t(41664),o=t.n(c),u=t(92401),l=t(63708),d=t(17662),p=t(26073),m=t(89681),h=t(65289),x=t(91472),f=t(83596),b=t(5802);function v(){var e,r,t=(0,h.useAuth)(),s=t.session,c=t.user,v=t.loading,g=(0,i.useRouter)(),y=(0,u.useState)(!0),w=y[0],j=y[1],N=(0,u.useState)([]),k=N[0],E=N[1],O=(0,u.useState)(null),I=O[0],_=O[1],Z=(e=(0,n.Z)(a().mark(function e(){var r,t,n,i,o,u,l;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!s||!c)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,j(!0),_(null),e.next=7,f.supabase.from("participations").select("event_id").eq("user_id",c.id);case 7:if(t=(r=e.sent).data,!(n=r.error)){e.next=15;break}return console.error("Fehler beim Laden der Teilnahmen:",n),_("Fehler beim Laden deiner Events. Bitte versuche es sp\xe4ter erneut."),j(!1),e.abrupt("return");case 15:if(!(!t||0===t.length)){e.next=19;break}return E([]),j(!1),e.abrupt("return");case 19:return i=t.map(function(e){return e.event_id}),e.next=22,f.supabase.from("contact_tables").select("\n          *,\n          restaurant:restaurant_id(*)\n        ").in("id",i).order("datetime",{ascending:!0});case 22:if(u=(o=e.sent).data,!(l=o.error)){e.next=30;break}return console.error("Fehler beim Laden der Kontakttische:",l),_("Fehler beim Laden deiner Events. Bitte versuche es sp\xe4ter erneut."),j(!1),e.abrupt("return");case 30:if(!(!u||0===u.length)){e.next=34;break}return E([]),j(!1),e.abrupt("return");case 34:E(u),j(!1),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(2),console.error("Fehler beim Laden der Kontakttische:",e.t0),_("Die Kontakttische konnten nicht geladen werden. Bitte versuche es sp\xe4ter erneut."),j(!1);case 43:case"end":return e.stop()}},e,null,[[2,38]])})),function(){return e.apply(this,arguments)}),C=(r=(0,n.Z)(a().mark(function e(r){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("M\xf6chten Sie wirklich nicht mehr an diesem Kontakttisch teilnehmen?")){e.next=17;break}if(e.prev=1,!(!c||!c.id)){e.next=4;break}throw Error("Benutzer nicht gefunden");case 4:return e.next=6,f.supabase.from("participations").delete().eq("event_id",r).eq("user_id",c.id);case 6:if(!(t=e.sent.error)){e.next=10;break}throw t;case 10:E(k.filter(function(e){return e.id!==r})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),console.error("Fehler beim Verlassen des Kontakttisches:",e.t0),alert("Es ist ein Fehler aufgetreten. Bitte versuchen Sie es sp\xe4ter erneut.");case 17:case"end":return e.stop()}},e,null,[[1,13]])})),function(e){return r.apply(this,arguments)});(0,u.useEffect)(function(){if(!v){if(!s){g.push("/auth/login");return}if(c)try{var e,r=(((null===(e=c.user_metadata)||void 0===e?void 0:e.role)||"")+"").toUpperCase();if("CUSTOMER"!==r&&"USER"!==r){g.push("/");return}Z()}catch(e){console.error("Fehler bei der Rollenpr\xfcfung:",e),j(!1)}else j(!1)}},[s,c,v,g]);var S=function(e){switch(e){case"ACTIVE":return"bg-green-100 text-green-800";case"PENDING":return"bg-yellow-100 text-yellow-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},P=function(e){switch(e){case"ACTIVE":return"Aktiv";case"PENDING":return"Ausstehend";case"CANCELLED":return"Storniert";case"COMPLETED":return"Abgeschlossen";default:return e}},T=function(e){try{var r=new Date(e);return{date:r.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),time:r.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}}catch(r){return{date:e,time:""}}};return w?(0,b.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,b.jsx)(l.Z,{}),(0,b.jsx)("main",{className:"flex-grow flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-lg",children:"Laden..."})]})}),(0,b.jsx)(d.Z,{})]}):(0,b.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,b.jsx)(l.Z,{}),(0,b.jsxs)("div",{className:"flex-grow flex",children:[(0,b.jsx)(p.Z,{activePage:"events"}),(0,b.jsx)("main",{className:"flex-grow bg-gray-50 p-6",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsxs)(m.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,b.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold text-gray-800",children:"Meine Events"}),(0,b.jsx)(o(),{href:"/customer/create-event",legacyBehavior:!0,children:(0,b.jsxs)("a",{className:"bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg flex items-center transition duration-150",children:[(0,b.jsx)(x.OvN,{className:"mr-2"})," Event erstellen"]})})]}),I&&(0,b.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[(0,b.jsx)("strong",{className:"font-bold",children:"Fehler: "}),(0,b.jsx)("span",{className:"block sm:inline",children:I})]}),0===k.length&&!w&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(x.vlc,{className:"mx-auto text-6xl text-gray-400 mb-4"}),(0,b.jsx)("h2",{className:"text-2xl font-semibold text-gray-700 mb-2",children:"Keine Events gefunden"}),(0,b.jsx)("p",{className:"text-gray-500 mb-6",children:"Sie nehmen derzeit an keinen Events teil oder haben noch keine erstellt."}),(0,b.jsx)(o(),{href:"/restaurants",legacyBehavior:!0,children:(0,b.jsxs)("a",{className:"bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-6 rounded-lg inline-flex items-center transition duration-150",children:[(0,b.jsx)(x.OvN,{className:"mr-2"})," Neue Kontakttische entdecken"]})})]}),k.length>0&&(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(function(e){var r=T(e.datetime||""),t=r.date,n=r.time;return(0,b.jsx)(m.E.div,{className:"bg-white shadow-lg rounded-xl overflow-hidden hover:shadow-xl transition-shadow duration-300 ease-in-out relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsx)("h3",{className:"text-xl font-semibold text-primary-700 truncate",title:e.title||"Unbenannter Tisch",children:e.title||"Unbenannter Tisch"}),(0,b.jsx)("span",{className:"px-3 py-1 text-xs font-semibold rounded-full ".concat(S(e.status||"UNKNOWN")),children:P(e.status||"UNKNOWN")})]}),e.restaurant&&(0,b.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[(0,b.jsx)(x.i63,{className:"mr-2 text-secondary-500 flex-shrink-0"}),(0,b.jsxs)("span",{className:"truncate",title:"".concat(e.restaurant.name,", ").concat(e.restaurant.address),children:[e.restaurant.name,", ",e.restaurant.address]})]}),(0,b.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[(0,b.jsx)(x.vlc,{className:"mr-2 text-secondary-500 flex-shrink-0"}),(0,b.jsx)("span",{children:t})]}),(0,b.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-3",children:[(0,b.jsx)(x.TCC,{className:"mr-2 text-secondary-500 flex-shrink-0"}),(0,b.jsxs)("span",{children:[n," Uhr"]})]}),(0,b.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-4",children:[(0,b.jsx)(x.WY8,{className:"mr-2 text-secondary-500 flex-shrink-0"}),(0,b.jsx)("span",{children:void 0!==e.participants_count?"".concat(e.participants_count," / ").concat(e.max_participants," Teilnehmer"):"? / ".concat(e.max_participants," Teilnehmer")})]}),e.description&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-gray-50 rounded-md",children:(0,b.jsxs)("div",{className:"flex items-start text-sm text-gray-700",children:[(0,b.jsx)(x.H33,{className:"mr-2 mt-1 text-secondary-500 flex-shrink-0"}),(0,b.jsx)("p",{className:"break-words clamp-3 leading-relaxed",title:e.description,children:e.description})]})}),(0,b.jsxs)("div",{className:"mt-auto border-t pt-4 flex justify-end space-x-3",children:[(0,b.jsxs)("button",{onClick:function(){return g.push("/customer/edit-event/".concat(e.id))},className:"text-primary-600 hover:text-primary-800 transition-colors duration-150 text-sm font-medium flex items-center",title:"Event bearbeiten",children:[(0,b.jsx)(x.IYd,{className:"mr-1.5 h-4 w-4"})," Bearbeiten"]}),(0,b.jsxs)("button",{onClick:function(){return C(e.id)},className:"text-red-500 hover:text-red-700 transition-colors duration-150 text-sm font-medium flex items-center",title:"Event verlassen",children:[(0,b.jsx)(x.Ybf,{className:"mr-1.5 h-4 w-4"})," Verlassen"]})]})]})},e.id)})})]})})})]}),(0,b.jsx)(d.Z,{})]})}},83596:function(e,r,t){"use strict";t.r(r),t.d(r,{admin:function(){return _},auth:function(){return E},profiles:function(){return O},restaurants:function(){return I},supabase:function(){return k}});var n,s,a,i,c,o,u,l,d,p,m,h,x=t(59499),f=t(50029),b=t(64687),v=t.n(b),g=t(86405);function y(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function w(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?y(Object(t),!0).forEach(function(r){(0,x.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var j="https://efmbzrmroyetcqxcwxka.supabase.co",N="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4";j&&N||console.error("Kritischer Fehler: Supabase URL oder Anon Key fehlen in der Client-Konfiguration.");var k=(0,g.createBrowserClient)(j,N,{auth:{storageKey:"contact-tables-auth",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),E={signUp:(n=(0,f.Z)(v().mark(function e(r,t){var n,s,a,i,c=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},e.next=3,k.auth.signUp({email:r,password:t,options:{data:w(w({},n),{},{role:n.role||"CUSTOMER"})}});case 3:return a=(s=e.sent).data,i=s.error,e.abrupt("return",{data:a,error:i});case 7:case"end":return e.stop()}},e)})),function(e,r){return n.apply(this,arguments)}),signIn:(s=(0,f.Z)(v().mark(function e(r,t){var n,s,a;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.signInWithPassword({email:r,password:t});case 2:return s=(n=e.sent).data,a=n.error,e.abrupt("return",{data:s,error:a});case 6:case"end":return e.stop()}},e)})),function(e,r){return s.apply(this,arguments)}),signInWithGoogle:(a=(0,f.Z)(v().mark(function e(r){var t,n,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.signInWithOAuth({provider:"google",options:{redirectTo:(null==r?void 0:r.redirectTo)||"".concat(window.location.origin,"/auth/callback")}});case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),signOut:(i=(0,f.Z)(v().mark(function e(){var r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.signOut();case 2:return r=e.sent.error,e.abrupt("return",{error:r});case 5:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)}),getUser:(c=(0,f.Z)(v().mark(function e(){var r,t,n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.getUser();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)}),getSession:(o=(0,f.Z)(v().mark(function e(){var r,t,n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.getSession();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)}),resetPassword:(u=(0,f.Z)(v().mark(function e(r){var t,n,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.resetPasswordForEmail(r,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)}),updatePassword:(l=(0,f.Z)(v().mark(function e(r){var t,n,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.auth.updateUser({password:r});case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})},O={getProfile:(d=(0,f.Z)(v().mark(function e(r){var t,n,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("profiles").select("*").eq("id",r).single();case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return d.apply(this,arguments)}),updateProfile:(p=(0,f.Z)(v().mark(function e(r,t){var n,s,a;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("profiles").update(t).eq("id",r);case 2:return s=(n=e.sent).data,a=n.error,e.abrupt("return",{data:s,error:a});case 6:case"end":return e.stop()}},e)})),function(e,r){return p.apply(this,arguments)})},I={getRestaurantProfile:(m=(0,f.Z)(v().mark(function e(r){var t,n,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("restaurants").select("*").eq("user_id",r).single();case 2:return n=(t=e.sent).data,s=t.error,e.abrupt("return",{data:n,error:s});case 6:case"end":return e.stop()}},e)})),function(e){return m.apply(this,arguments)})},_={getAllUsers:(h=(0,f.Z)(v().mark(function e(){var r,t,n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.from("profiles").select("*");case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return h.apply(this,arguments)})}},80290:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customer/events",function(){return t(20260)}])}},function(e){e.O(0,[6130,3365,6058,6405,8428,300,3708,6328,2888,9774,179],function(){return e(e.s=80290)}),_N_E=e.O()}]);