(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7535],{65289:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return h},useAuth:function(){return x}});var n=r(59499),s=r(50029),i=r(64687),a=r.n(i),o=r(92401),c=r(11163),l=r(87553),u=r(5802);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var p=(0,o.createContext)(void 0),h=function(e){var t,r,n,i,d,h,x=e.children,f=(0,l.createClient)(),g=(0,o.useState)(null),v=g[0],b=g[1],w=(0,o.useState)(null),j=w[0],y=w[1],k=(0,o.useState)(null),N=k[0],S=k[1],O=(0,o.useState)(!0),_=O[0],C=O[1];(0,c.useRouter)(),(0,o.useEffect)(function(){C(!0),f.auth.getSession().then(function(e){var t,r,n=e.data.session;b(n);var s=null!==(t=null==n?void 0:n.user)&&void 0!==t?t:null;y(s),S((null==s||null===(r=s.user_metadata)||void 0===r?void 0:r.role)||null),C(!1)}).catch(function(e){console.error("Error getting initial session:",e),C(!1)});var e=f.auth.onAuthStateChange(function(e,t){console.log("[AuthContext] Auth state changed. Event: ".concat(e),{hasSession:!!t}),b(t);var r,n,s=null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null;y(s),S((null==s||null===(n=s.user_metadata)||void 0===n?void 0:n.role)||null),C(!1)}).data.subscription;return function(){e.unsubscribe()}},[]);var E={session:v,user:j,loading:_,userRole:N,signIn:(t=(0,s.Z)(a().mark(function e(t,r){var n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.auth.signInWithPassword({email:t,password:r});case 3:return n=e.sent,e.abrupt("return",{data:n.data,error:n.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,r){return t.apply(this,arguments)}),signInWithGoogle:(r=(0,s.Z)(a().mark(function e(){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});case 3:return t=e.sent,e.abrupt("return",{data:t.data,error:t.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return r.apply(this,arguments)}),signUp:(n=(0,s.Z)(a().mark(function e(t,r,n){var s;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Registrierung gestartet mit:",{email:t,userData:n}),e.next=4,f.auth.signUp({email:t,password:r,options:{data:m(m({},n),{},{role:(null==n?void 0:n.role)||"CUSTOMER"}),emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});case 4:return(s=e.sent).error?console.error("Supabase Registrierungsfehler:",s.error):console.log("Registrierung erfolgreich:",s.data),e.abrupt("return",{data:s.data,error:s.error});case 9:return e.prev=9,e.t0=e.catch(0),console.error("Unerwarteter Fehler bei der Registrierung:",e.t0),e.abrupt("return",{data:null,error:m({message:"Verbindungsfehler zum Authentifizierungsserver. Bitte versuchen Sie es sp\xe4ter erneut."},e.t0)});case 13:case"end":return e.stop()}},e,null,[[0,9]])})),function(e,t,r){return n.apply(this,arguments)}),signOut:(i=(0,s.Z)(a().mark(function e(){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.auth.signOut();case 3:return t=e.sent.error,e.abrupt("return",{error:t});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{error:e.t0});case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return i.apply(this,arguments)}),resetPassword:(d=(0,s.Z)(a().mark(function e(t){var r;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.auth.resetPasswordForEmail(t,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 3:return r=e.sent,e.abrupt("return",{data:r.data,error:r.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return d.apply(this,arguments)}),handleAuthCallback:(h=(0,s.Z)(a().mark(function e(t){var r,n,s,i,o;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.auth.exchangeCodeForSession(t);case 3:if(s=(n=e.sent).data,!(i=n.error)){e.next=8;break}return e.abrupt("return",{error:i,userRole:void 0});case 8:return o=(null==s||null===(r=s.session)||void 0===r||null===(r=r.user)||void 0===r||null===(r=r.user_metadata)||void 0===r?void 0:r.role)||"CUSTOMER",e.abrupt("return",{error:null,userRole:o});case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{error:e.t0,userRole:void 0});case 15:case"end":return e.stop()}},e,null,[[0,12]])})),function(e){return h.apply(this,arguments)})};return(0,u.jsx)(p.Provider,{value:E,children:x})},x=function(){var e=(0,o.useContext)(p);if(void 0===e)throw Error("useAuth muss innerhalb eines AuthProviders verwendet werden");return e}},58900:function(e,t,r){"use strict";r.r(t),r.d(t,{CreateEvent:function(){return E},__N_SSP:function(){return z},default:function(){return A}});var n,s,i,a,o=r(17674),c=r(59499),l=r(50029),u=r(64687),d=r.n(u),m=r(92401),p=r(11163),h=r(65289),x=r(87553),f=r(9008),g=r.n(f),v=r(41664),b=r.n(v),w=r(41338),j=r(90116),y=r(86405);r(83454);var k=r(83454);function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach(function(t){(0,c.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var O=r(5802);function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach(function(t){(0,c.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function E(){var e,t=(0,h.useAuth)(),r=t.session,n=t.user,s=(0,p.useRouter)(),i=(0,x.createClient)(),a=(0,m.useState)({title:"",description:"",date:"",time:"",restaurant_id:"",max_participants:4,is_private:!1,price:0}),u=a[0],f=a[1],v=(0,m.useState)([]),j=v[0],y=v[1],k=(0,m.useState)(!1),N=k[0],S=k[1],_=(0,m.useState)(null),E=_[0],z=_[1],A=(0,m.useState)(!1),P=A[0],I=A[1],D=(0,m.useState)({title:!1,description:!1,date:!1,time:!1,restaurant_id:!1,max_participants:!1,price:!1}),R=D[0],Z=D[1],M=(0,m.useState)({}),T=M[0],B=M[1];(0,m.useEffect)(function(){var e;(e=(0,l.Z)(d().mark(function e(){var t,r,n;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.from("restaurants").select("id, name, address, city, is_active").eq("is_active",!0).order("name");case 3:if(r=(t=e.sent).data,!(n=t.error)){e.next=8;break}throw n;case 8:y((null==r?void 0:r.map(function(e){return{id:e.id,name:e.name,address:e.address,city:e.city,is_active:e.is_active}}))||[]),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Fehler beim Laden der Restaurants:",e.t0),z("Restaurants konnten nicht geladen werden: "+e.t0.message);case 15:case"end":return e.stop()}},e,null,[[0,11]])})),function(){return e.apply(this,arguments)})()},[i]);var F=function(e){var t={},r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate());if(e.title.trim()?e.title.length<3?t.title="Titel muss mindestens 3 Zeichen lang sein":e.title.length>100&&(t.title="Titel darf maximal 100 Zeichen lang sein"):t.title="Titel ist erforderlich",e.description&&e.description.length<10?t.description="Beschreibung sollte mindestens 10 Zeichen lang sein":e.description&&e.description.length>1e3&&(t.description="Beschreibung darf maximal 1000 Zeichen lang sein"),e.date){var s=new Date(e.date);isNaN(s.getTime())?t.date="Ung\xfcltiges Datum":s<n?t.date="Datum muss in der Zukunft liegen":s>new Date(n.getTime()+31536e6)&&(t.date="Datum darf maximal ein Jahr in der Zukunft liegen")}else t.date="Datum ist erforderlich";return e.time?/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e.time)||(t.time="Ung\xfcltiges Uhrzeitformat (HH:MM)"):t.time="Uhrzeit ist erforderlich",e.date&&e.time&&new Date("".concat(e.date,"T").concat(e.time))<=new Date&&(t.time="Event muss in der Zukunft liegen"),e.restaurant_id||(t.restaurant_id="Restaurant ist erforderlich"),e.max_participants<2?t.max_participants="Mindestens 2 Teilnehmer erforderlich":e.max_participants>20&&(t.max_participants="Maximal 20 Teilnehmer erlaubt"),e.price<0?t.price="Preis kann nicht negativ sein":e.price>1e3&&(t.price="Preis darf maximal 1000€ betragen"),t};(0,m.useMemo)(function(){B(F(u))},[u]);var U=function(e){var t=e.target,r=t.name,n=t.value,s=t.type;if(Z(function(e){return C(C({},e),{},(0,c.Z)({},r,!0))}),"checkbox"===s){var i=e.target.checked;f(function(e){return C(C({},e),{},(0,c.Z)({},r,i))})}else"max_participants"===r?f(function(e){return C(C({},e),{},(0,c.Z)({},r,parseInt(n)||0))}):f(function(e){return C(C({},e),{},(0,c.Z)({},r,n))})},q=function(e){var t=e.target.name;Z(function(e){return C(C({},e),{},(0,c.Z)({},t,!0))})},J=(e=(0,l.Z)(d().mark(function e(t){var i,a,o,c;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),Z(Object.keys(u).reduce(function(e,t){return e[t]=!0,e},{})),B(i=F(u)),!(Object.keys(i).length>0)){e.next=8;break}return z("Bitte korrigieren Sie die Fehler im Formular."),e.abrupt("return");case 8:if(S(!0),z(null),e.prev=10,!(!r||!n)){e.next=13;break}throw Error("Sie m\xfcssen angemeldet sein, um ein Event zu erstellen.");case 13:return a=new Date("".concat(u.date,"T").concat(u.time)),e.next=16,fetch("/api/contact-tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:u.title,description:u.description,datetime:a.toISOString(),restaurant_id:u.restaurant_id,max_participants:u.max_participants,price:u.price,is_public:!u.is_private})});case 16:return o=e.sent,e.next=19,o.json();case 19:if(c=e.sent,o.ok){e.next=22;break}throw Error(c.error||"Das Event konnte nicht erstellt werden.");case 22:I(!0),setTimeout(function(){s.push("/customer/events")},2e3),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(10),console.error("Fehler beim Erstellen des Events:",e.t0),z(e.t0.message||"Das Event konnte nicht erstellt werden.");case 30:return e.prev=30,S(!1),e.finish(30);case 33:case"end":return e.stop()}},e,null,[[10,26,30,33]])})),function(t){return e.apply(this,arguments)});return r&&n?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(g(),{children:(0,O.jsx)("title",{children:"Event erstellen | Contact Tables"})}),(0,O.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,O.jsxs)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,O.jsx)("div",{className:"mb-8 flex items-center",children:(0,O.jsxs)(b(),{href:"/customer/events",className:"flex items-center text-indigo-600 hover:text-indigo-900",children:[(0,O.jsx)(w.x_l,{className:"mr-2"}),"Zur\xfcck zur \xdcbersicht"]})}),(0,O.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,O.jsxs)("div",{className:"px-4 py-5 border-b border-gray-200 sm:px-6",children:[(0,O.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Neues Event erstellen"}),(0,O.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Erstellen Sie ein neues Event und laden Sie andere Benutzer ein."})]}),P?(0,O.jsx)("div",{className:"px-4 py-5 sm:p-6",children:(0,O.jsx)("div",{className:"rounded-md bg-green-50 p-4",children:(0,O.jsxs)("div",{className:"flex",children:[(0,O.jsx)("div",{className:"flex-shrink-0",children:(0,O.jsx)("svg",{className:"h-5 w-5 text-green-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,O.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,O.jsxs)("div",{className:"ml-3",children:[(0,O.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"Event erfolgreich erstellt"}),(0,O.jsx)("div",{className:"mt-2 text-sm text-green-700",children:(0,O.jsx)("p",{children:"Sie werden zur Events-\xdcbersicht weitergeleitet."})})]})]})})}):(0,O.jsxs)("form",{onSubmit:J,className:"px-4 py-5 sm:p-6",children:[E&&(0,O.jsx)("div",{className:"rounded-md bg-red-50 p-4 mb-6",children:(0,O.jsxs)("div",{className:"flex",children:[(0,O.jsx)("div",{className:"flex-shrink-0",children:(0,O.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,O.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,O.jsxs)("div",{className:"ml-3",children:[(0,O.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Fehler"}),(0,O.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,O.jsx)("p",{children:E})})]})]})}),Object.keys(T).length>0&&(0,O.jsx)("div",{className:"rounded-md bg-yellow-50 p-4 mb-6",children:(0,O.jsxs)("div",{className:"flex",children:[(0,O.jsx)("div",{className:"flex-shrink-0",children:(0,O.jsx)("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,O.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,O.jsxs)("div",{className:"ml-3",children:[(0,O.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Bitte korrigieren Sie die folgenden Fehler:"}),(0,O.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,O.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:Object.entries(T).map(function(e){var t=(0,o.Z)(e,2),r=t[0],n=t[1];return(0,O.jsx)("li",{children:n},r)})})})]})]})}),(0,O.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,O.jsxs)("div",{className:"col-span-2",children:[(0,O.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Titel*"}),(0,O.jsx)("input",{type:"text",name:"title",id:"title",required:!0,value:u.title,onChange:U,onBlur:q,className:"mt-1 block w-full shadow-sm sm:text-sm rounded-md ".concat(R.title&&T.title?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-indigo-500 focus:border-indigo-500")}),R.title&&T.title&&(0,O.jsx)("p",{className:"mt-1 text-sm text-red-600",children:T.title})]}),(0,O.jsxs)("div",{className:"col-span-2",children:[(0,O.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Beschreibung"}),(0,O.jsx)("textarea",{name:"description",id:"description",rows:3,value:u.description,onChange:U,onBlur:q,className:"mt-1 block w-full shadow-sm sm:text-sm rounded-md ".concat(R.description&&T.description?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-indigo-500 focus:border-indigo-500")}),R.description&&T.description&&(0,O.jsx)("p",{className:"mt-1 text-sm text-red-600",children:T.description})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700",children:"Datum*"}),(0,O.jsx)("input",{type:"date",name:"date",id:"date",required:!0,value:u.date,onChange:U,onBlur:q,min:new Date().toISOString().split("T")[0],className:"mt-1 block w-full shadow-sm sm:text-sm rounded-md ".concat(R.date&&T.date?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-indigo-500 focus:border-indigo-500")}),R.date&&T.date&&(0,O.jsx)("p",{className:"mt-1 text-sm text-red-600",children:T.date})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-700",children:"Uhrzeit*"}),(0,O.jsx)("input",{type:"time",name:"time",id:"time",required:!0,value:u.time,onChange:U,onBlur:q,className:"mt-1 block w-full shadow-sm sm:text-sm rounded-md ".concat(R.time&&T.time?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-indigo-500 focus:border-indigo-500")}),R.time&&T.time&&(0,O.jsx)("p",{className:"mt-1 text-sm text-red-600",children:T.time})]}),(0,O.jsxs)("div",{className:"col-span-2",children:[(0,O.jsx)("label",{htmlFor:"restaurant_id",className:"block text-sm font-medium text-gray-700",children:"Restaurant*"}),(0,O.jsxs)("select",{name:"restaurant_id",id:"restaurant_id",required:!0,value:u.restaurant_id,onChange:U,onBlur:q,className:"mt-1 block w-full shadow-sm sm:text-sm rounded-md ".concat(R.restaurant_id&&T.restaurant_id?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-indigo-500 focus:border-indigo-500"),children:[(0,O.jsx)("option",{value:"",children:"-- Restaurant ausw\xe4hlen --"}),j.map(function(e){return(0,O.jsxs)("option",{value:e.id,children:[e.name," (",e.city,")"]},e.id)})]}),R.restaurant_id&&T.restaurant_id&&(0,O.jsx)("p",{className:"mt-1 text-sm text-red-600",children:T.restaurant_id})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{htmlFor:"max_participants",className:"block text-sm font-medium text-gray-700",children:"Maximale Teilnehmerzahl*"}),(0,O.jsx)("input",{type:"number",name:"max_participants",id:"max_participants",min:"2",max:"20",required:!0,value:u.max_participants,onChange:U,onBlur:q,className:"mt-1 block w-full shadow-sm sm:text-sm rounded-md ".concat(R.max_participants&&T.max_participants?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-indigo-500 focus:border-indigo-500")}),R.max_participants&&T.max_participants&&(0,O.jsx)("p",{className:"mt-1 text-sm text-red-600",children:T.max_participants})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Preis (€)"}),(0,O.jsx)("input",{type:"number",name:"price",id:"price",min:"0",step:"0.01",value:u.price,onChange:U,onBlur:q,className:"mt-1 block w-full shadow-sm sm:text-sm rounded-md ".concat(R.price&&T.price?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-indigo-500 focus:border-indigo-500")}),R.price&&T.price&&(0,O.jsx)("p",{className:"mt-1 text-sm text-red-600",children:T.price})]}),(0,O.jsx)("div",{children:(0,O.jsxs)("div",{className:"flex items-center h-full mt-6",children:[(0,O.jsx)("input",{type:"checkbox",name:"is_private",id:"is_private",checked:u.is_private,onChange:U,className:"focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"}),(0,O.jsx)("label",{htmlFor:"is_private",className:"ml-2 block text-sm text-gray-700",children:"Privates Event (nur mit Einladung)"})]})})]}),(0,O.jsxs)("div",{className:"mt-8 flex justify-end",children:[(0,O.jsxs)(b(),{href:"/customer/events",className:"mr-4 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,O.jsx)(w.aHS,{className:"mr-2 h-5 w-5"}),"Abbrechen"]}),(0,O.jsxs)("button",{type:"submit",disabled:N,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[N?(0,O.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,O.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,O.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,O.jsx)(w.TvB,{className:"mr-2 h-5 w-5"}),"Event erstellen"]})]})]})]})]})})]}):(0,O.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:(0,O.jsxs)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[(0,O.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Nicht autorisiert"}),(0,O.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sie m\xfcssen angemeldet sein, um auf diese Seite zuzugreifen."}),(0,O.jsx)("div",{className:"mt-8 text-center",children:(0,O.jsx)(b(),{href:"/auth/login",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Zum Login"})})]})})}var z=!0,A=(s=["CUSTOMER","USER"],n=(0,l.Z)(d().mark(function e(t){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{props:{}});case 1:case"end":return e.stop()}},e)})),i=function(e){return n.apply(this,arguments)},a=(0,l.Z)(d().mark(function e(t){var r,n,a,o,c,l,u,m,p,h,x,f;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(!t.req||"phase-export"===k.env.NEXT_PHASE)){e.next=3;break}return e.abrupt("return",{notFound:!0});case 3:return console.log("withAuth: Ausf\xfchrung f\xfcr Pfad",t.resolvedUrl),o=function(e){var t="https://efmbzrmroyetcqxcwxka.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4";if(!t||!r)throw console.error("Server: Supabase URL oder Anon Key fehlen in der Konfiguration."),Error("Server-side Supabase configuration is missing.");console.log("Server createClient: Verf\xfcgbare Cookies:",e.req.cookies),console.log("Server createClient: Auth-Cookie vorhanden?",!!e.req.cookies["contact-tables-auth"]);var n=e.req.headers.host||"",s=e.req.headers["x-forwarded-proto"]||"http",i="".concat(s,"://").concat(n);return console.log("Server createClient: Request Host:",n),console.log("Server createClient: Request Protocol:",s),console.log("Server createClient: Request Origin:",i),(0,y.createServerClient)(t,r,{cookies:{get:function(t){"contact-tables-auth"===t&&console.log("Alle verf\xfcgbaren Cookies:",Object.keys(e.req.cookies));var r=e.req.cookies[t];return console.log("Server cookie get: ".concat(t," = ").concat(r?"vorhanden":"nicht vorhanden")),r},set:function(t,r,n){console.log("Server cookie set: ".concat(t," = [Wert gek\xfcrzt]")),console.log("Server cookie options:",n);var s=e.req.headers.host||"",i=s.includes("contact-tables.org"),a=s.includes("netlify.app"),o=["".concat(t,"=").concat(r),"Path=".concat(n.path||"/"),"Max-Age=".concat(n.maxAge),"SameSite=".concat(n.sameSite||"Lax")];i?(o.push("Domain=.contact-tables.org"),console.log("Cookie Domain gesetzt auf: .contact-tables.org")):a&&console.log("Netlify-Domain erkannt, verwende Standard-Domain-Verhalten"),!1!==n.httpOnly&&o.push("HttpOnly"),e.req.headers["x-forwarded-proto"],o.push("Secure"),console.log("Cookie als Secure markiert");var c=o.join("; ");if(console.log("Server cookie string:",c),e.res){var l=e.res.getHeader("Set-Cookie");console.log("Server existing cookies:",l);var u=[];"string"==typeof l?u.push(l):Array.isArray(l)&&(u=(0,j.Z)(l)),u.push(c),e.res.setHeader("Set-Cookie",u),console.log("Server set cookies header with",u.length,"cookies")}else console.warn("Server: context.res ist nicht verf\xfcgbar, kann Cookie nicht setzen")},remove:function(t,r){var n=["".concat(t,"="),"Path=".concat(r.path||"/"),"Max-Age=0","SameSite=".concat(r.sameSite||"Lax")];!1!==r.httpOnly&&n.push("HttpOnly"),r.secure&&n.push("Secure");var s=n.join("; ");if(e.res){var i=e.res.getHeader("Set-Cookie"),a=[];"string"==typeof i?a.push(i):Array.isArray(i)&&(a=(0,j.Z)(i)),a.push(s),e.res.setHeader("Set-Cookie",a)}}},cookieOptions:{name:"contact-tables-auth",maxAge:604800,sameSite:"lax",path:"/",secure:!0}})}(t),e.next=7,o.auth.getUser();case 7:if(l=(c=e.sent).data.user,u=c.error,console.log("withAuth: Benutzer gefunden?",!!l),u&&console.error("withAuth: Fehler beim Abrufen des Benutzers:",u),l){e.next=15;break}return console.log("withAuth: Keine Benutzersession gefunden, Weiterleitung zur Login-Seite"),e.abrupt("return",{redirect:{destination:"/auth/login?callbackUrl=".concat(encodeURIComponent(t.resolvedUrl)),permanent:!1}});case 15:if(console.log("withAuth: Benutzerrolle:",m=(null===(r=l.app_metadata)||void 0===r?void 0:r.role)||(null===(n=l.user_metadata)||void 0===n?void 0:n.role)||"USER","isAdmin:",p=(null===(a=l.app_metadata)||void 0===a?void 0:a.is_admin)===!0),console.log("withAuth: Erforderliche Rollen:",h=Array.isArray(s)?s:[s]),h.includes(m)||h.includes("admin")&&"ADMIN"===m||h.includes("ADMIN")&&"admin"===m||p&&(h.includes("admin")||h.includes("ADMIN"))){e.next=24;break}return console.log("withAuth: Benutzer hat nicht die erforderliche Rolle, Weiterleitung zur 403-Seite"),e.abrupt("return",{redirect:{destination:"/403",permanent:!1}});case 24:return console.log("withAuth: Benutzer authentifiziert und autorisiert, f\xfchre urspr\xfcngliche Funktion aus"),e.next=27,i(t,l);case 27:if(!("props"in(x=e.sent))){e.next=33;break}return e.next=31,Promise.resolve(x.props);case 31:return f=e.sent,e.abrupt("return",S(S({},x),{},{props:S(S({},f),{},{user:l})}));case 33:return e.abrupt("return",x);case 36:return e.prev=36,e.t0=e.catch(0),console.error("withAuth: Unerwarteter Fehler:",e.t0),e.abrupt("return",{redirect:{destination:"/auth/login",permanent:!1}});case 40:case"end":return e.stop()}},e,null,[[0,36]])})),function(e){return a.apply(this,arguments)})},87553:function(e,t,r){"use strict";r.r(t),r.d(t,{createClient:function(){return s}});var n=r(86405);function s(){console.log("Client createClient: Erstelle Browser-Client"),window.location.protocol;var e=window.location.hostname,t=e.includes("contact-tables.org");e.includes("netlify.app");var r={name:"contact-tables-auth",maxAge:604800,sameSite:"lax",path:"/",secure:!0};t&&(console.log("Client: Cookie Domain f\xfcr .contact-tables.org gesetzt"),Object.assign(r,{domain:".contact-tables.org"}));var s=(0,n.createBrowserClient)("https://efmbzrmroyetcqxcwxka.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4",{cookieOptions:r});return s.auth.getSession().then(function(e){console.log("Client createClient: Session vorhanden?",!!e.data.session)}).catch(function(e){console.error("Client createClient: Fehler beim Abrufen der Session:",e)}),s}},83793:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customer/create-event",function(){return r(58900)}])}},function(e){e.O(0,[3365,6058,6405,3341,2888,9774,179],function(){return e(e.s=83793)}),_N_E=e.O()}]);