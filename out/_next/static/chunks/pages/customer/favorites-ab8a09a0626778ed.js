(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8e3],{49165:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return j}});var n=t(90116),a=t(59499),s=t(50029),i=t(64687),o=t.n(i),c=t(11163),u=t(41664),d=t.n(u),l=t(92401),f=t(63708),p=t(17662),h=t(26073),m=t(89681),x=t(65289),b=t(91472),g=t(83596),v=t(5802);function w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function y(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?w(Object(t),!0).forEach(function(r){(0,a.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function j(){var e,r,t=(0,x.useAuth)(),a=t.session,i=t.user,u=t.loading,w=(0,c.useRouter)(),j=(0,l.useState)(!0),k=j[0],O=j[1],N=(0,l.useState)([]),_=N[0],P=N[1],Z=(0,l.useState)(null),E=Z[0],F=Z[1],I=(e=(0,s.Z)(o().mark(function e(){var r,t,s,c,u,d,l,f;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!a||!i)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,O(!0),F(null),e.next=7,g.supabase.from("favorites").select("restaurant_id").eq("user_id",i.id);case 7:if(t=(r=e.sent).data,!(s=r.error)){e.next=15;break}return console.error("Fehler beim Laden der Favoriten:",s),F("Fehler beim Laden deiner Favoriten. Bitte versuche es sp\xe4ter erneut."),O(!1),e.abrupt("return");case 15:if(!(t&&t.length>0)){e.next=30;break}return c=t.map(function(e){return e.restaurant_id}),e.next=19,g.supabase.from("restaurants").select("\n            *,\n            contact_tables(*)\n          ").in("id",c);case 19:if(d=(u=e.sent).data,!(l=u.error)){e.next=27;break}return console.error("Fehler beim Laden der favorisierten Restaurants:",l),F("Fehler beim Laden deiner Favoriten. Bitte versuche es sp\xe4ter erneut."),O(!1),e.abrupt("return");case 27:d&&d.length>0?(f=[],d.forEach(function(e){if(e.contact_tables&&e.contact_tables.length>0){var r=e.contact_tables.map(function(r){return y(y({},r),{},{restaurant:{id:e.id,name:e.name,address:e.address,city:e.city,postal_code:e.postal_code}})});f.push.apply(f,(0,n.Z)(r))}}),f.sort(function(e,r){return new Date(e.datetime).getTime()-new Date(r.datetime).getTime()}),P(f)):P([]),e.next=31;break;case 30:P([]);case 31:O(!1),e.next=39;break;case 34:e.prev=34,e.t0=e.catch(2),console.error("Fehler beim Laden der Favoriten:",e.t0),F("Ein unerwarteter Fehler ist aufgetreten. Bitte versuche es sp\xe4ter erneut."),O(!1);case 39:case"end":return e.stop()}},e,null,[[2,34]])})),function(){return e.apply(this,arguments)}),S=(r=(0,s.Z)(o().mark(function e(r){var t,n,a;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!(!(t=_.find(function(e){return e.id===r}))||!t.restaurant)){e.next=6;break}throw Error("Kontakttisch oder Restaurant nicht gefunden");case 6:return n=t.restaurant.id,e.next=9,g.supabase.from("favorites").delete().eq("user_id",i.id).eq("restaurant_id",n);case 9:if(!(a=e.sent.error)){e.next=13;break}throw a;case 13:P(_.filter(function(e){var r;return(null===(r=e.restaurant)||void 0===r?void 0:r.id)!==n})),F(null),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(2),console.error("Fehler beim Entfernen des Favoriten:",e.t0),F("Der Favorit konnte nicht entfernt werden. Bitte versuche es sp\xe4ter erneut.");case 21:case"end":return e.stop()}},e,null,[[2,17]])})),function(e){return r.apply(this,arguments)});(0,l.useEffect)(function(){if(!u){if(!a){w.push("/auth/login");return}if(i)try{var e,r=(((null===(e=i.user_metadata)||void 0===e?void 0:e.role)||"")+"").toUpperCase();if("CUSTOMER"!==r&&"USER"!==r){w.push("/");return}I()}catch(e){console.error("Fehler bei der Rollenpr\xfcfung:",e),O(!1)}else O(!1)}},[a,i,u,w]);var D=function(e){var r=new Date(e);return{date:r.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),time:r.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}};return(0,v.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,v.jsx)(f.Z,{}),(0,v.jsxs)("div",{className:"flex-grow flex",children:[(0,v.jsx)(h.Z,{activePage:"favorites"}),(0,v.jsx)("main",{className:"flex-grow bg-gray-50 p-6",children:(0,v.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,v.jsxs)(m.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,v.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,v.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Meine Favoriten"})}),E&&(0,v.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,v.jsx)("p",{className:"text-red-700",children:E})}),k?(0,v.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,v.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"})}):0===_.length?(0,v.jsxs)("div",{className:"text-center py-12",children:[(0,v.jsx)(b.$aX,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,v.jsx)("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Keine Favoriten"}),(0,v.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Du hast noch keine Kontakttische zu deinen Favoriten hinzugef\xfcgt."}),(0,v.jsx)("div",{className:"mt-6",children:(0,v.jsx)("button",{type:"button",onClick:function(){return w.push("/contact-tables")},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Kontakttische entdecken"})})]}):(0,v.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:_.map(function(e){var r,t=D(e.datetime||""),n=t.date,a=t.time;return(0,v.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg transition-all duration-300 hover:shadow-lg",children:(0,v.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,v.jsx)("h3",{className:"text-lg font-medium text-gray-900 truncate",children:e.title}),(0,v.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[(0,v.jsx)(b.i63,{className:"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400"}),(0,v.jsx)("p",{className:"truncate",children:(null===(r=e.restaurant)||void 0===r?void 0:r.name)||"Unbekanntes Restaurant"})]}),(0,v.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[(0,v.jsx)(b.vlc,{className:"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400"}),(0,v.jsx)("p",{children:n})]}),(0,v.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[(0,v.jsx)(b.TCC,{className:"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400"}),(0,v.jsxs)("p",{children:[a," Uhr"]})]}),(0,v.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[(0,v.jsx)(b.WY8,{className:"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400"}),(0,v.jsxs)("p",{children:[e.participant_count||0,"/",e.max_participants," Teilnehmer"]})]}),(0,v.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,v.jsx)(d(),{href:"/contact-tables/".concat(e.id),children:(0,v.jsx)("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Details"})}),(0,v.jsxs)("button",{type:"button",onClick:function(){return S(e.id)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[(0,v.jsx)(b.Ybf,{className:"mr-1.5 h-4 w-4"}),"Entfernen"]})]})]})},e.id)})})]})})})]}),(0,v.jsx)(p.Z,{})]})}},83596:function(e,r,t){"use strict";t.r(r),t.d(r,{admin:function(){return Z},auth:function(){return N},profiles:function(){return _},restaurants:function(){return P},supabase:function(){return O}});var n,a,s,i,o,c,u,d,l,f,p,h,m=t(59499),x=t(50029),b=t(64687),g=t.n(b),v=t(86405);function w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function y(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?w(Object(t),!0).forEach(function(r){(0,m.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var j="https://efmbzrmroyetcqxcwxka.supabase.co",k="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4";j&&k||console.error("Kritischer Fehler: Supabase URL oder Anon Key fehlen in der Client-Konfiguration.");var O=(0,v.createBrowserClient)(j,k,{auth:{storageKey:"contact-tables-auth",persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),N={signUp:(n=(0,x.Z)(g().mark(function e(r,t){var n,a,s,i,o=arguments;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:{},e.next=3,O.auth.signUp({email:r,password:t,options:{data:y(y({},n),{},{role:n.role||"CUSTOMER"})}});case 3:return s=(a=e.sent).data,i=a.error,e.abrupt("return",{data:s,error:i});case 7:case"end":return e.stop()}},e)})),function(e,r){return n.apply(this,arguments)}),signIn:(a=(0,x.Z)(g().mark(function e(r,t){var n,a,s;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.auth.signInWithPassword({email:r,password:t});case 2:return a=(n=e.sent).data,s=n.error,e.abrupt("return",{data:a,error:s});case 6:case"end":return e.stop()}},e)})),function(e,r){return a.apply(this,arguments)}),signInWithGoogle:(s=(0,x.Z)(g().mark(function e(r){var t,n,a;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.auth.signInWithOAuth({provider:"google",options:{redirectTo:(null==r?void 0:r.redirectTo)||"".concat(window.location.origin,"/auth/callback")}});case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)}),signOut:(i=(0,x.Z)(g().mark(function e(){var r;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.auth.signOut();case 2:return r=e.sent.error,e.abrupt("return",{error:r});case 5:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)}),getUser:(o=(0,x.Z)(g().mark(function e(){var r,t,n;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.auth.getUser();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)}),getSession:(c=(0,x.Z)(g().mark(function e(){var r,t,n;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.auth.getSession();case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)}),resetPassword:(u=(0,x.Z)(g().mark(function e(r){var t,n,a;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.auth.resetPasswordForEmail(r,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)}),updatePassword:(d=(0,x.Z)(g().mark(function e(r){var t,n,a;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.auth.updateUser({password:r});case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return d.apply(this,arguments)})},_={getProfile:(l=(0,x.Z)(g().mark(function e(r){var t,n,a;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.from("profiles").select("*").eq("id",r).single();case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)}),updateProfile:(f=(0,x.Z)(g().mark(function e(r,t){var n,a,s;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.from("profiles").update(t).eq("id",r);case 2:return a=(n=e.sent).data,s=n.error,e.abrupt("return",{data:a,error:s});case 6:case"end":return e.stop()}},e)})),function(e,r){return f.apply(this,arguments)})},P={getRestaurantProfile:(p=(0,x.Z)(g().mark(function e(r){var t,n,a;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.from("restaurants").select("*").eq("user_id",r).single();case 2:return n=(t=e.sent).data,a=t.error,e.abrupt("return",{data:n,error:a});case 6:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)})},Z={getAllUsers:(h=(0,x.Z)(g().mark(function e(){var r,t,n;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.from("profiles").select("*");case 2:return t=(r=e.sent).data,n=r.error,e.abrupt("return",{data:t,error:n});case 6:case"end":return e.stop()}},e)})),function(){return h.apply(this,arguments)})}},61887:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customer/favorites",function(){return t(49165)}])}},function(e){e.O(0,[6130,3365,6058,6405,8428,300,3708,6328,2888,9774,179],function(){return e(e.s=61887)}),_N_E=e.O()}]);