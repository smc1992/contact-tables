(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5289],{65289:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return f},useAuth:function(){return v}});var n=t(59499),o=t(50029),a=t(64687),u=t.n(a),s=t(92401),i=t(11163),c=t(87553),l=t(5802);function p(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function d(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?p(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var h=(0,s.createContext)(void 0),f=function(e){var r,t,n,a,p,f,v=e.children,g=(0,c.createClient)(),b=(0,s.useState)(null),w=b[0],m=b[1],O=(0,s.useState)(null),x=O[0],C=O[1],y=(0,s.useState)(null),S=y[0],k=y[1],I=(0,s.useState)(!0),j=I[0],P=I[1];(0,i.useRouter)(),(0,s.useEffect)(function(){P(!0),g.auth.getSession().then(function(e){var r,t,n=e.data.session;m(n);var o=null!==(r=null==n?void 0:n.user)&&void 0!==r?r:null;C(o),k((null==o||null===(t=o.user_metadata)||void 0===t?void 0:t.role)||null),P(!1)}).catch(function(e){console.error("Error getting initial session:",e),P(!1)});var e=g.auth.onAuthStateChange(function(e,r){console.log("[AuthContext] Auth state changed. Event: ".concat(e),{hasSession:!!r}),m(r);var t,n,o=null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null;C(o),k((null==o||null===(n=o.user_metadata)||void 0===n?void 0:n.role)||null),P(!1)}).data.subscription;return function(){e.unsubscribe()}},[]);var R={session:w,user:x,loading:j,userRole:S,signIn:(r=(0,o.Z)(u().mark(function e(r,t){var n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.auth.signInWithPassword({email:r,password:t});case 3:return n=e.sent,e.abrupt("return",{data:n.data,error:n.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t){return r.apply(this,arguments)}),signInWithGoogle:(t=(0,o.Z)(u().mark(function e(){var r;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});case 3:return r=e.sent,e.abrupt("return",{data:r.data,error:r.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return t.apply(this,arguments)}),signUp:(n=(0,o.Z)(u().mark(function e(r,t,n){var o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Registrierung gestartet mit:",{email:r,userData:n}),e.next=4,g.auth.signUp({email:r,password:t,options:{data:d(d({},n),{},{role:(null==n?void 0:n.role)||"CUSTOMER"}),emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});case 4:return(o=e.sent).error?console.error("Supabase Registrierungsfehler:",o.error):console.log("Registrierung erfolgreich:",o.data),e.abrupt("return",{data:o.data,error:o.error});case 9:return e.prev=9,e.t0=e.catch(0),console.error("Unerwarteter Fehler bei der Registrierung:",e.t0),e.abrupt("return",{data:null,error:d({message:"Verbindungsfehler zum Authentifizierungsserver. Bitte versuchen Sie es sp\xe4ter erneut."},e.t0)});case 13:case"end":return e.stop()}},e,null,[[0,9]])})),function(e,r,t){return n.apply(this,arguments)}),signOut:(a=(0,o.Z)(u().mark(function e(){var r;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.auth.signOut();case 3:return r=e.sent.error,e.abrupt("return",{error:r});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{error:e.t0});case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return a.apply(this,arguments)}),resetPassword:(p=(0,o.Z)(u().mark(function e(r){var t;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.auth.resetPasswordForEmail(r,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 3:return t=e.sent,e.abrupt("return",{data:t.data,error:t.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return p.apply(this,arguments)}),handleAuthCallback:(f=(0,o.Z)(u().mark(function e(r){var t,n,o,a,s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.auth.exchangeCodeForSession(r);case 3:if(o=(n=e.sent).data,!(a=n.error)){e.next=8;break}return e.abrupt("return",{error:a,userRole:void 0});case 8:return s=(null==o||null===(t=o.session)||void 0===t||null===(t=t.user)||void 0===t||null===(t=t.user_metadata)||void 0===t?void 0:t.role)||"CUSTOMER",e.abrupt("return",{error:null,userRole:s});case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{error:e.t0,userRole:void 0});case 15:case"end":return e.stop()}},e,null,[[0,12]])})),function(e){return f.apply(this,arguments)})};return(0,l.jsx)(h.Provider,{value:R,children:v})},v=function(){var e=(0,s.useContext)(h);if(void 0===e)throw Error("useAuth muss innerhalb eines AuthProviders verwendet werden");return e}},87553:function(e,r,t){"use strict";t.r(r),t.d(r,{createClient:function(){return o}});var n=t(86405);function o(){console.log("Client createClient: Erstelle Browser-Client"),window.location.protocol;var e=window.location.hostname,r=e.includes("contact-tables.org");e.includes("netlify.app");var t={name:"contact-tables-auth",maxAge:604800,sameSite:"lax",path:"/",secure:!0};r&&(console.log("Client: Cookie Domain f\xfcr .contact-tables.org gesetzt"),Object.assign(t,{domain:".contact-tables.org"}));var o=(0,n.createBrowserClient)("https://efmbzrmroyetcqxcwxka.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4",{cookieOptions:t});return o.auth.getSession().then(function(e){console.log("Client createClient: Session vorhanden?",!!e.data.session)}).catch(function(e){console.error("Client createClient: Fehler beim Abrufen der Session:",e)}),o}},11163:function(e,r,t){e.exports=t(11171)},50029:function(e,r,t){"use strict";function n(e,r,t,n,o,a,u){try{var s=e[a](u),i=s.value}catch(e){t(e);return}s.done?r(i):Promise.resolve(i).then(n,o)}function o(e){return function(){var r=this,t=arguments;return new Promise(function(o,a){var u=e.apply(r,t);function s(e){n(u,o,a,s,i,"next",e)}function i(e){n(u,o,a,s,i,"throw",e)}s(void 0)})}}t.d(r,{Z:function(){return o}})}}]);