"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3708],{63708:function(e,r,t){t.d(r,{Z:function(){return v}});var s=t(90116),n=t(92401),a=t(41664),i=t.n(a),o=t(13114),l=t(89681),c=t(91472),u=t(65289),d=t(50029),x=t(64687),m=t.n(x),h=t(25675),g=t.n(h),p=t(5802),f=function(){var e,r,t,s,a,x=(0,u.useAuth)(),h=x.session,f=x.user,v=x.loading,b=x.userRole,y=(0,n.useState)(!1),j=y[0],N=y[1],w=(0,n.useRef)(null);(0,n.useEffect)(function(){console.log("UserMenu - userRole from AuthContext:",b),console.log("UserMenu - user object:",f)},[b,f]),(0,n.useEffect)(function(){var e=function(e){w.current&&!w.current.contains(e.target)&&N(!1)};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}},[]);var z=(0,u.useAuth)().signOut,C=(e=(0,d.Z)(m().mark(function e(){return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z();case 2:N(!1);case 3:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)});return v?(0,p.jsx)("div",{className:"relative",children:(0,p.jsx)("div",{className:"w-8 h-8 bg-gray-300 rounded-full animate-pulse"})}):h&&f?(0,p.jsxs)("div",{className:"relative",ref:w,children:[(0,p.jsxs)("button",{onClick:function(){return N(!j)},className:"flex items-center space-x-2 bg-white hover:bg-gray-50 border border-gray-200 rounded-full py-1 pl-1 pr-3 transition-colors",children:[null!=f&&null!==(r=f.user_metadata)&&void 0!==r&&r.avatar_url?(0,p.jsx)(g(),{src:f.user_metadata.avatar_url,alt:(null===(t=f.user_metadata)||void 0===t?void 0:t.name)||"User avatar",width:32,height:32}):(0,p.jsx)(c.fzv,{className:"text-primary-500",size:18}),(0,p.jsx)("span",{className:"text-sm font-medium text-gray-700",children:null!==(s=f.user_metadata)&&void 0!==s&&s.name?f.user_metadata.name.split(" ")[0]:"Mein Konto"})]}),(0,p.jsx)(o.M,{children:j&&(0,p.jsx)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg py-2 z-50 border border-gray-200",children:f?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"px-4 py-2 border-b border-gray-100",children:[(0,p.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:(null===(a=f.user_metadata)||void 0===a?void 0:a.name)||"User"}),(0,p.jsx)("p",{className:"text-xs text-gray-500",children:f.email}),b&&(0,p.jsx)("p",{className:"text-xs font-medium text-indigo-500 mt-1",children:"RESTAURANT"===b?"Restaurant-Konto":"ADMIN"===b||"admin"===b?"Admin-Konto":"Kunden-Konto"})]}),("CUSTOMER"===b||"USER"===b)&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(i(),{href:"/customer/profile",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.fzv,{className:"mr-3 text-gray-500",size:16}),"Mein Profil"]}),(0,p.jsxs)(i(),{href:"/customer/favorites",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.$aX,{className:"mr-3 text-gray-500",size:16}),"Favoriten"]}),(0,p.jsxs)(i(),{href:"/customer/events",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.vlc,{className:"mr-3 text-gray-500",size:16}),"Meine Events"]}),(0,p.jsxs)(i(),{href:"/customer/notifications",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.vWP,{className:"mr-3 text-gray-500",size:16}),"Benachrichtigungen"]}),(0,p.jsxs)(i(),{href:"/customer/settings",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.nbt,{className:"mr-3 text-gray-500",size:16}),"Einstellungen"]})]}),"RESTAURANT"===b&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(i(),{href:"/restaurant/dashboard",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.i63,{className:"mr-3 text-gray-500",size:16}),"Restaurant-Dashboard"]}),(0,p.jsxs)(i(),{href:"/restaurant/dashboard/profile",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.fzv,{className:"mr-3 text-gray-500",size:16}),"Restaurant-Profil"]}),(0,p.jsxs)(i(),{href:"/restaurant/dashboard/contact-tables",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.vlc,{className:"mr-3 text-gray-500",size:16}),"Kontakttische verwalten"]})]}),("ADMIN"===b||"admin"===b)&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"px-4 py-1 bg-blue-50",children:(0,p.jsx)("p",{className:"text-xs font-semibold text-blue-700 uppercase tracking-wider",children:"Admin-Navigation"})}),(0,p.jsxs)(i(),{href:"/admin/dashboard",className:"flex items-center px-4 py-2 text-sm text-indigo-700 hover:bg-indigo-50",children:[(0,p.jsx)(c.aCJ,{className:"mr-3 text-indigo-500",size:16}),"Dashboard"]}),(0,p.jsxs)(i(),{href:"/admin/users",className:"flex items-center px-4 py-2 text-sm text-indigo-700 hover:bg-indigo-50",children:[(0,p.jsx)(c.WY8,{className:"mr-3 text-indigo-500",size:16}),"Benutzer"]}),(0,p.jsxs)(i(),{href:"/admin/email-builder",className:"flex items-center px-4 py-2 text-sm text-indigo-700 hover:bg-indigo-50",children:[(0,p.jsx)(c.Imn,{className:"mr-3 text-indigo-500",size:16}),"E-Mail-Builder"]}),(0,p.jsxs)(i(),{href:"/admin/categories",className:"flex items-center px-4 py-2 text-sm text-indigo-700 hover:bg-indigo-50",children:[(0,p.jsx)(c.E25,{className:"mr-3 text-indigo-500",size:16}),"Kategorien"]}),(0,p.jsxs)(i(),{href:"/admin/settings",className:"flex items-center px-4 py-2 text-sm text-indigo-700 hover:bg-indigo-50",children:[(0,p.jsx)(c.nbt,{className:"mr-3 text-indigo-500",size:16}),"Einstellungen"]})]}),(0,p.jsx)("div",{className:"border-t border-gray-100 my-1"}),(0,p.jsxs)("button",{onClick:C,className:"flex w-full items-center px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:[(0,p.jsx)(c.xqh,{className:"mr-3 text-red-500",size:16}),"Abmelden"]})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(i(),{href:"/auth/login",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.fzv,{className:"mr-3 text-gray-500",size:16}),"Anmelden"]}),(0,p.jsxs)(i(),{href:"/auth/register",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,p.jsx)(c.fzv,{className:"mr-3 text-gray-500",size:16}),"Registrieren"]})]})})})]}):null};function v(){var e,r=(0,n.useState)(!1),t=r[0],a=r[1],d=(0,n.useState)(!1),x=d[0],m=d[1],h=(0,u.useAuth)().user;(0,n.useEffect)(function(){var e=function(){m(window.scrollY>10)};return window.addEventListener("scroll",e),function(){return window.removeEventListener("scroll",e)}},[]);var g=(null==h||null===(e=h.user_metadata)||void 0===e?void 0:e.role)==="RESTAURANT",v=[{href:"/restaurants",label:"Restaurants",icon:c.i63},{href:"/contact-tables",label:"contact-tables",icon:c.WY8}].concat((0,s.Z)(g?[{href:"/restaurant/dashboard",label:"Mein Restaurant",icon:c.Gpi}]:[]),[{href:"/about",label:"\xdcber uns",icon:c.H33},{href:"/faq",label:"H\xe4ufige Fragen",icon:c.bax}]);return(0,p.jsxs)("header",{className:"sticky top-0 z-50 transition-all duration-300 ".concat(x?"bg-white shadow-md":"bg-white"),children:[(0,p.jsx)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:(0,p.jsxs)("div",{className:"flex items-center justify-between h-20",children:[(0,p.jsx)("div",{className:"flex-shrink-0",children:(0,p.jsx)(i(),{href:"/",className:"flex items-center space-x-2",children:(0,p.jsx)("img",{className:"h-16 w-auto",src:"/images/logo-fixed/Logo CT mittig 4c.webp",alt:"contact-tables-logo"})})}),(0,p.jsx)("nav",{className:"hidden md:flex md:items-center md:space-x-2 lg:space-x-4",children:(0,p.jsx)("div",{className:"bg-primary-50/50 rounded-full p-1 flex items-center space-x-1",children:v.map(function(e){return(0,p.jsxs)(i(),{href:e.href,className:"px-3 py-2 rounded-full text-sm font-medium text-gray-700 hover:bg-primary-100 hover:text-primary-600 transition-colors flex items-center space-x-2",children:[e.icon&&(0,p.jsx)(e.icon,{className:"h-5 w-5"}),(0,p.jsx)("span",{children:e.label})]},e.label)})})}),(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("div",{className:"hidden md:block",children:h?(0,p.jsx)(f,{}):(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsxs)(i(),{href:"/auth/login",className:"bg-white hover:bg-neutral-100 text-secondary-700 font-bold py-2 px-4 rounded-full flex items-center space-x-1 transition-all border-2 border-primary-500 shadow-sm",children:[(0,p.jsx)(c._fJ,{size:18}),(0,p.jsx)("span",{children:"Login"})]}),(0,p.jsxs)(i(),{href:"/auth/register",className:"bg-primary-500 hover:bg-primary-600 text-white font-bold py-2 px-4 rounded-full flex items-center space-x-1 transition-all shadow-sm",children:[(0,p.jsx)(c.zy7,{size:18}),(0,p.jsx)("span",{children:"Registrieren"})]})]})}),(0,p.jsx)("div",{className:"md:hidden",children:(0,p.jsxs)("button",{onClick:function(){return a(!t)},className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500",children:[(0,p.jsx)("span",{className:"sr-only",children:"Men\xfc \xf6ffnen"}),t?(0,p.jsx)(c.q5L,{className:"h-6 w-6"}):(0,p.jsx)(c.cur,{className:"h-6 w-6"})]})})]})]})}),(0,p.jsx)(o.M,{children:t&&(0,p.jsx)(l.E.div,{className:"md:hidden bg-white",initial:"hidden",animate:"visible",exit:"hidden",variants:{hidden:{opacity:0,y:-20},visible:{opacity:1,y:0}},children:(0,p.jsxs)("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:[v.map(function(e){return(0,p.jsxs)(i(),{href:e.href,className:"flex items-center w-full p-2 text-base text-gray-900 transition duration-75 rounded-lg group hover:bg-gray-100",children:[e.icon&&(0,p.jsx)(e.icon,{className:"h-6 w-6 mr-3"}),(0,p.jsx)("span",{children:e.label})]},e.label)}),(0,p.jsx)("div",{className:"border-t border-gray-200 my-2"}),h?(0,p.jsx)("div",{className:"p-2",children:(0,p.jsx)(f,{})}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(i(),{href:"/auth/login",className:"flex items-center w-full p-2 text-base text-gray-900 transition duration-75 rounded-lg group hover:bg-gray-100",children:[(0,p.jsx)(c._fJ,{className:"h-6 w-6 mr-3"}),(0,p.jsx)("span",{children:"Login"})]}),(0,p.jsxs)(i(),{href:"/auth/register",className:"flex items-center w-full p-2 text-base text-gray-900 transition duration-75 rounded-lg group hover:bg-gray-100",children:[(0,p.jsx)(c.zy7,{className:"h-6 w-6 mr-3"}),(0,p.jsx)("span",{children:"Registrieren"})]})]})]})})})]})}},65289:function(e,r,t){t.r(r),t.d(r,{AuthProvider:function(){return h},useAuth:function(){return g}});var s=t(59499),n=t(50029),a=t(64687),i=t.n(a),o=t(92401),l=t(11163),c=t(87553),u=t(5802);function d(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,s)}return t}function x(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?d(Object(t),!0).forEach(function(r){(0,s.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var m=(0,o.createContext)(void 0),h=function(e){var r,t,s,a,d,h,g=e.children,p=(0,c.createClient)(),f=(0,o.useState)(null),v=f[0],b=f[1],y=(0,o.useState)(null),j=y[0],N=y[1],w=(0,o.useState)(null),z=w[0],C=w[1],R=(0,o.useState)(!0),E=R[0],O=R[1];(0,l.useRouter)(),(0,o.useEffect)(function(){O(!0),p.auth.getSession().then(function(e){var r,t,s=e.data.session;b(s);var n=null!==(r=null==s?void 0:s.user)&&void 0!==r?r:null;N(n),C((null==n||null===(t=n.user_metadata)||void 0===t?void 0:t.role)||null),O(!1)}).catch(function(e){console.error("Error getting initial session:",e),O(!1)});var e=p.auth.onAuthStateChange(function(e,r){console.log("[AuthContext] Auth state changed. Event: ".concat(e),{hasSession:!!r}),b(r);var t,s,n=null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null;N(n),C((null==n||null===(s=n.user_metadata)||void 0===s?void 0:s.role)||null),O(!1)}).data.subscription;return function(){e.unsubscribe()}},[]);var k={session:v,user:j,loading:E,userRole:z,signIn:(r=(0,n.Z)(i().mark(function e(r,t){var s;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.auth.signInWithPassword({email:r,password:t});case 3:return s=e.sent,e.abrupt("return",{data:s.data,error:s.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e,t){return r.apply(this,arguments)}),signInWithGoogle:(t=(0,n.Z)(i().mark(function e(){var r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});case 3:return r=e.sent,e.abrupt("return",{data:r.data,error:r.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return t.apply(this,arguments)}),signUp:(s=(0,n.Z)(i().mark(function e(r,t,s){var n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Registrierung gestartet mit:",{email:r,userData:s}),e.next=4,p.auth.signUp({email:r,password:t,options:{data:x(x({},s),{},{role:(null==s?void 0:s.role)||"CUSTOMER"}),emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});case 4:return(n=e.sent).error?console.error("Supabase Registrierungsfehler:",n.error):console.log("Registrierung erfolgreich:",n.data),e.abrupt("return",{data:n.data,error:n.error});case 9:return e.prev=9,e.t0=e.catch(0),console.error("Unerwarteter Fehler bei der Registrierung:",e.t0),e.abrupt("return",{data:null,error:x({message:"Verbindungsfehler zum Authentifizierungsserver. Bitte versuchen Sie es sp\xe4ter erneut."},e.t0)});case 13:case"end":return e.stop()}},e,null,[[0,9]])})),function(e,r,t){return s.apply(this,arguments)}),signOut:(a=(0,n.Z)(i().mark(function e(){var r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.auth.signOut();case 3:return r=e.sent.error,e.abrupt("return",{error:r});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{error:e.t0});case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return a.apply(this,arguments)}),resetPassword:(d=(0,n.Z)(i().mark(function e(r){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.auth.resetPasswordForEmail(r,{redirectTo:"https://contact-tables.org/auth/reset-password"});case 3:return t=e.sent,e.abrupt("return",{data:t.data,error:t.error});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return d.apply(this,arguments)}),handleAuthCallback:(h=(0,n.Z)(i().mark(function e(r){var t,s,n,a,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.auth.exchangeCodeForSession(r);case 3:if(n=(s=e.sent).data,!(a=s.error)){e.next=8;break}return e.abrupt("return",{error:a,userRole:void 0});case 8:return o=(null==n||null===(t=n.session)||void 0===t||null===(t=t.user)||void 0===t||null===(t=t.user_metadata)||void 0===t?void 0:t.role)||"CUSTOMER",e.abrupt("return",{error:null,userRole:o});case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{error:e.t0,userRole:void 0});case 15:case"end":return e.stop()}},e,null,[[0,12]])})),function(e){return h.apply(this,arguments)})};return(0,u.jsx)(m.Provider,{value:k,children:g})},g=function(){var e=(0,o.useContext)(m);if(void 0===e)throw Error("useAuth muss innerhalb eines AuthProviders verwendet werden");return e}},87553:function(e,r,t){t.r(r),t.d(r,{createClient:function(){return n}});var s=t(86405);function n(){console.log("Client createClient: Erstelle Browser-Client"),window.location.protocol;var e=window.location.hostname,r=e.includes("contact-tables.org");e.includes("netlify.app");var t={name:"contact-tables-auth",maxAge:604800,sameSite:"lax",path:"/",secure:!0};r&&(console.log("Client: Cookie Domain f\xfcr .contact-tables.org gesetzt"),Object.assign(t,{domain:".contact-tables.org"}));var n=(0,s.createBrowserClient)("https://efmbzrmroyetcqxcwxka.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbWJ6cm1yb3lldGNxeGN3eGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MjkzNDgsImV4cCI6MjA2MzMwNTM0OH0.ohJQapQUce_nuK0Ra30WUQGfchrSG3ZTx43jxV0f0I4",{cookieOptions:t});return n.auth.getSession().then(function(e){console.log("Client createClient: Session vorhanden?",!!e.data.session)}).catch(function(e){console.error("Client createClient: Fehler beim Abrufen der Session:",e)}),n}}}]);